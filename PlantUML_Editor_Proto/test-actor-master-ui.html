<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã‚¢ã‚¯ã‚¿ãƒ¼ãƒã‚¹ã‚¿ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹UIãƒ†ã‚¹ãƒˆ</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="modal-styles.css">
    <style>
        body {
            padding: 20px;
        }
        .test-controls {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-button {
            padding: 10px 20px;
            margin: 5px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .test-button:hover {
            background: #1976D2;
        }
        .status-output {
            margin-top: 20px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>ã‚¢ã‚¯ã‚¿ãƒ¼ãƒã‚¹ã‚¿ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹UI ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸</h1>
    
    <div class="test-controls">
        <h2>ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</h2>
        <button class="test-button" id="test-show-modal">ãƒã‚¹ã‚¿ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹UIã‚’è¡¨ç¤º</button>
        <button class="test-button" id="test-add-actor">ãƒ†ã‚¹ãƒˆã‚¢ã‚¯ã‚¿ãƒ¼è¿½åŠ </button>
        <button class="test-button" id="test-export">ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
        <button class="test-button" id="test-check-status">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª</button>
    </div>
    
    <div class="status-output" id="status-output">
        æº–å‚™å®Œäº†...
    </div>

    <!-- Scripts -->
    <script src="SafeDOMManager.js"></script>
    <script src="ActorMasterManager.js"></script>
    <script src="ActorMasterMaintenanceUI.js"></script>
    
    <script>
        // ãƒ†ã‚¹ãƒˆç”¨ã®åˆæœŸåŒ–
        let actorMasterManager = null;
        let actorMasterMaintenanceUI = null;
        
        window.addEventListener('DOMContentLoaded', async () => {
            const output = document.getElementById('status-output');
            
            try {
                // ActorMasterManagerã®åˆæœŸåŒ–
                actorMasterManager = new ActorMasterManager();
                await actorMasterManager.loadMasterData();
                output.textContent += '\nâœ… ActorMasterManager åˆæœŸåŒ–å®Œäº†';
                
                // ActorMasterMaintenanceUIã®åˆæœŸåŒ–
                actorMasterMaintenanceUI = new ActorMasterMaintenanceUI(actorMasterManager);
                output.textContent += '\nâœ… ActorMasterMaintenanceUI åˆæœŸåŒ–å®Œäº†';
                
                // ç¾åœ¨ã®ã‚¢ã‚¯ã‚¿ãƒ¼æ•°ã‚’è¡¨ç¤º
                const actors = actorMasterManager.getAllActors();
                output.textContent += `\nğŸ“Š ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚¢ã‚¯ã‚¿ãƒ¼æ•°: ${actors.length}`;
                
                // ã‚«ãƒ†ã‚´ãƒªãƒ¼æƒ…å ±
                const categories = actorMasterManager.categoriesMap;
                output.textContent += `\nğŸ“ ã‚«ãƒ†ã‚´ãƒªãƒ¼æ•°: ${categories.size}`;
                
            } catch (error) {
                output.textContent += `\nâŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                console.error('Initialization error:', error);
            }
        });
        
        // ãƒã‚¹ã‚¿ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹UIã‚’è¡¨ç¤º
        document.getElementById('test-show-modal').addEventListener('click', () => {
            if (actorMasterMaintenanceUI) {
                actorMasterMaintenanceUI.show();
                document.getElementById('status-output').textContent += '\nğŸ”µ ãƒã‚¹ã‚¿ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹UIã‚’è¡¨ç¤ºã—ã¾ã—ãŸ';
            } else {
                document.getElementById('status-output').textContent += '\nâŒ UIãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“';
            }
        });
        
        // ãƒ†ã‚¹ãƒˆã‚¢ã‚¯ã‚¿ãƒ¼è¿½åŠ 
        document.getElementById('test-add-actor').addEventListener('click', () => {
            if (actorMasterManager) {
                const testActor = {
                    name: 'ãƒ†ã‚¹ãƒˆã‚¢ã‚¯ã‚¿ãƒ¼' + Date.now(),
                    icon: 'ğŸ§ª',
                    categoryId: 'business',
                    description: 'ãƒ†ã‚¹ãƒˆç”¨ã®ã‚¢ã‚¯ã‚¿ãƒ¼',
                    color: '#FF5722'
                };
                actorMasterManager.addCustomActor(testActor);
                document.getElementById('status-output').textContent += `\nâ• ãƒ†ã‚¹ãƒˆã‚¢ã‚¯ã‚¿ãƒ¼è¿½åŠ : ${testActor.name}`;
            }
        });
        
        // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        document.getElementById('test-export').addEventListener('click', () => {
            if (actorMasterManager) {
                const data = {
                    ...actorMasterManager.masterData,
                    customActors: actorMasterManager.exportCustomActors(),
                    exportDate: new Date().toISOString()
                };
                const json = JSON.stringify(data, null, 2);
                document.getElementById('status-output').textContent += `\nğŸ“¥ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ (${json.length} bytes)`;
            }
        });
        
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
        document.getElementById('test-check-status').addEventListener('click', () => {
            if (actorMasterManager) {
                const actors = actorMasterManager.getAllActors();
                const categories = actorMasterManager.categoriesMap;
                const defaultActors = actorMasterManager.getDefaultActors();
                
                let status = '\n=== ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª ===';
                status += `\nç·ã‚¢ã‚¯ã‚¿ãƒ¼æ•°: ${actors.length}`;
                status += `\nã‚«ãƒ†ã‚´ãƒªãƒ¼æ•°: ${categories.size}`;
                status += `\nãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¢ã‚¯ã‚¿ãƒ¼æ•°: ${defaultActors.length}`;
                status += '\n\nã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ã‚¢ã‚¯ã‚¿ãƒ¼æ•°:';
                
                categories.forEach((cat, id) => {
                    const catActors = actorMasterManager.getActorsByCategory(id);
                    status += `\n  ${cat.name}: ${catActors.length}`;
                });
                
                document.getElementById('status-output').textContent += status;
            }
        });
    </script>
</body>
</html>