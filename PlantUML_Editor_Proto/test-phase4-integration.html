<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 4 Áµ±Âêà„ÉÜ„Çπ„Éà„Çπ„Ç§„Éº„Éà - PlantUML Editor</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }

        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }

        .test-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .test-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .test-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        .test-section h3 {
            color: #667eea;
            margin-top: 0;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .test-controls {
            margin-bottom: 15px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            box-shadow: 0 2px 10px rgba(255, 107, 107, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
            box-shadow: 0 2px 10px rgba(81, 207, 102, 0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffd43b 0%, #fab005 100%);
            box-shadow: 0 2px 10px rgba(255, 212, 59, 0.3);
        }

        .test-result {
            background: #f8f9fa;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #dee2e6;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }

        .test-result.success {
            background: #d4edda;
            border-left-color: #28a745;
            color: #155724;
        }

        .test-result.error {
            background: #f8d7da;
            border-left-color: #dc3545;
            color: #721c24;
        }

        .test-result.warning {
            background: #fff3cd;
            border-left-color: #ffc107;
            color: #856404;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #eee;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #51cf66, #40c057);
            width: 0%;
            transition: width 0.3s ease;
        }

        .metrics-dashboard {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .metric-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #dee2e6;
        }

        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .metric-label {
            color: #666;
            margin-top: 5px;
            font-size: 0.9em;
        }

        .test-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            resize: vertical;
            margin-bottom: 10px;
        }

        .test-output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
            max-height: 300px;
            overflow-y: auto;
        }

        .error-details {
            background: #fff5f5;
            border: 1px solid #fed7d7;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            color: #c53030;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .test-status {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 10px;
        }

        .status-passed {
            background: #d4edda;
            color: #155724;
        }

        .status-failed {
            background: #f8d7da;
            color: #721c24;
        }

        .status-running {
            background: #fff3cd;
            color: #856404;
        }

        .console-log {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .console-log .log-error {
            color: #fc8181;
        }

        .console-log .log-warning {
            color: #f6e05e;
        }

        .console-log .log-info {
            color: #63b3ed;
        }

        .console-log .log-success {
            color: #68d391;
        }

        .tab-container {
            margin-top: 20px;
        }

        .tab-buttons {
            display: flex;
            background: #f1f3f4;
            border-radius: 10px 10px 0 0;
            overflow: hidden;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 15px 25px;
            cursor: pointer;
            font-weight: 500;
            color: #666;
            transition: all 0.2s ease;
            flex: 1;
        }

        .tab-button.active {
            background: #667eea;
            color: white;
        }

        .tab-content {
            background: white;
            padding: 20px;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üß™ Phase 4 Áµ±Âêà„ÉÜ„Çπ„Éà„Çπ„Ç§„Éº„Éà</h1>
        <p>„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞„ÄÅ„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊúÄÈÅ©Âåñ„ÄÅÂÖ•ÂäõÊ§úË®º„ÅÆÂåÖÊã¨ÁöÑ„ÉÜ„Çπ„Éà</p>
    </div>

    <!-- „É°„Éà„É™„ÇØ„Çπ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ -->
    <div class="metrics-dashboard">
        <h3>üìä „ÉÜ„Çπ„Éà„É°„Éà„É™„ÇØ„Çπ</h3>
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value" id="total-tests">0</div>
                <div class="metric-label">Á∑è„ÉÜ„Çπ„ÉàÊï∞</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="passed-tests">0</div>
                <div class="metric-label">ÊàêÂäü</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="failed-tests">0</div>
                <div class="metric-label">Â§±Êïó</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="success-rate">0%</div>
                <div class="metric-label">ÊàêÂäüÁéá</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="avg-time">0ms</div>
                <div class="metric-label">Âπ≥ÂùáÂÆüË°åÊôÇÈñì</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="memory-usage">0MB</div>
                <div class="metric-label">„É°„É¢„É™‰ΩøÁî®Èáè</div>
            </div>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
    </div>

    <!-- „Çø„Éñ„Ç≥„É≥„ÉÜ„Éä -->
    <div class="tab-container">
        <div class="tab-buttons">
            <button class="tab-button active" data-tab="integration">Áµ±Âêà„ÉÜ„Çπ„Éà</button>
            <button class="tab-button" data-tab="error">„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞</button>
            <button class="tab-button" data-tab="performance">„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ</button>
            <button class="tab-button" data-tab="validation">ÂÖ•ÂäõÊ§úË®º</button>
            <button class="tab-button" data-tab="stress">„Çπ„Éà„É¨„Çπ„ÉÜ„Çπ„Éà</button>
        </div>

        <!-- Áµ±Âêà„ÉÜ„Çπ„Éà„Çø„Éñ -->
        <div class="tab-content" id="tab-integration">
            <div class="test-container">
                <!-- Phase 4 Áµ±Âêà„ÉÜ„Çπ„Éà -->
                <div class="test-section">
                    <h3>üîß Phase 4 Ê©üËÉΩÁµ±Âêà„ÉÜ„Çπ„Éà</h3>
                    <div class="test-controls">
                        <button class="btn" onclick="testPhase4Integration()">
                            Áµ±Âêà„ÉÜ„Çπ„Éà„ÇíÂÆüË°å
                        </button>
                        <button class="btn btn-warning" onclick="resetTests()">
                            „ÉÜ„Çπ„ÉàÁµêÊûú„Çí„É™„Çª„ÉÉ„Éà
                        </button>
                    </div>
                    <div class="test-result" id="integration-result"></div>
                </div>

                <!-- ÂÖ®Ê©üËÉΩ„ÉÜ„Çπ„Éà -->
                <div class="test-section">
                    <h3>üéØ ÂÖ®Ê©üËÉΩÁ∂≤ÁæÖ„ÉÜ„Çπ„Éà</h3>
                    <div class="test-controls">
                        <button class="btn" onclick="testAllFeatures()">
                            ÂÖ®Ê©üËÉΩ„ÉÜ„Çπ„ÉàÂÆüË°å
                        </button>
                        <button class="btn btn-success" onclick="runBenchmark()">
                            „Éô„É≥„ÉÅ„Éû„Éº„ÇØÂÆüË°å
                        </button>
                    </div>
                    <div class="test-result" id="allfeatures-result"></div>
                </div>
            </div>
        </div>

        <!-- „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞„ÉÜ„Çπ„Éà„Çø„Éñ -->
        <div class="tab-content hidden" id="tab-error">
            <div class="test-container">
                <!-- „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞„ÉÜ„Çπ„Éà -->
                <div class="test-section">
                    <h3>‚ö†Ô∏è „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞„ÉÜ„Çπ„Éà</h3>
                    <div class="test-controls">
                        <button class="btn" onclick="testErrorHandling()">
                            „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞„ÉÜ„Çπ„Éà
                        </button>
                        <button class="btn btn-danger" onclick="triggerTestError()">
                            „ÉÜ„Çπ„Éà„Ç®„É©„Éº„ÇíÁô∫Áîü
                        </button>
                        <button class="btn btn-warning" onclick="testRecovery()">
                            Ëá™ÂãïÂæ©Êóß„ÉÜ„Çπ„Éà
                        </button>
                    </div>
                    <div class="test-result" id="error-result"></div>
                </div>

                <!-- „Ç®„É©„ÉºÁõ£Ë¶ñ -->
                <div class="test-section">
                    <h3>üìã „Ç®„É©„ÉºÁõ£Ë¶ñ</h3>
                    <div class="test-controls">
                        <button class="btn" onclick="showErrorMetrics()">
                            „Ç®„É©„Éº„É°„Éà„É™„ÇØ„ÇπË°®Á§∫
                        </button>
                        <button class="btn btn-danger" onclick="clearErrors()">
                            „Ç®„É©„Éº„É≠„Ç∞„ÇØ„É™„Ç¢
                        </button>
                    </div>
                    <div class="test-result" id="error-monitoring"></div>
                </div>
            </div>
        </div>

        <!-- „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉÜ„Çπ„Éà„Çø„Éñ -->
        <div class="tab-content hidden" id="tab-performance">
            <div class="test-container">
                <!-- „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉÜ„Çπ„Éà -->
                <div class="test-section">
                    <h3>‚ö° „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉÜ„Çπ„Éà</h3>
                    <div class="test-controls">
                        <button class="btn" onclick="testPerformance()">
                            „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉÜ„Çπ„ÉàÂÆüË°å
                        </button>
                        <button class="btn btn-success" onclick="optimizePerformance()">
                            ÊúÄÈÅ©ÂåñÂÆüË°å
                        </button>
                        <button class="btn btn-warning" onclick="memoryTest()">
                            „É°„É¢„É™„ÉÜ„Çπ„Éà
                        </button>
                    </div>
                    <div class="test-result" id="performance-result"></div>
                </div>

                <!-- „É°„É¢„É™Áõ£Ë¶ñ -->
                <div class="test-section">
                    <h3>üíæ „É°„É¢„É™Áõ£Ë¶ñ</h3>
                    <div class="test-controls">
                        <button class="btn" onclick="monitorMemory()">
                            „É°„É¢„É™Áõ£Ë¶ñÈñãÂßã
                        </button>
                        <button class="btn btn-danger" onclick="stopMemoryMonitor()">
                            Áõ£Ë¶ñÂÅúÊ≠¢
                        </button>
                    </div>
                    <div class="test-result" id="memory-result"></div>
                </div>
            </div>
        </div>

        <!-- ÂÖ•ÂäõÊ§úË®º„ÉÜ„Çπ„Éà„Çø„Éñ -->
        <div class="tab-content hidden" id="tab-validation">
            <div class="test-container">
                <!-- ÂÖ•ÂäõÊ§úË®º„ÉÜ„Çπ„Éà -->
                <div class="test-section">
                    <h3>‚úÖ ÂÖ•ÂäõÊ§úË®º„ÉÜ„Çπ„Éà</h3>
                    <textarea class="test-input" id="validation-input" placeholder="Ê§úË®º„Åô„Çã„ÉÜ„Ç≠„Çπ„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ..." rows="6">@startuml
A -> B : „ÉÜ„Çπ„Éà„É°„ÉÉ„Çª„Éº„Ç∏
B -> C : „É¨„Çπ„Éù„É≥„Çπ
@enduml</textarea>
                    <div class="test-controls">
                        <button class="btn" onclick="testValidation()">
                            ÂÖ•ÂäõÊ§úË®ºÂÆüË°å
                        </button>
                        <button class="btn btn-success" onclick="testAutoCorrect()">
                            Ëá™Âãï‰øÆÊ≠£„ÉÜ„Çπ„Éà
                        </button>
                        <button class="btn btn-warning" onclick="testSecurityValidation()">
                            „Çª„Ç≠„É•„É™„ÉÜ„Ç£Ê§úË®º
                        </button>
                    </div>
                    <div class="test-result" id="validation-result"></div>
                </div>

                <!-- „É™„Ç¢„É´„Çø„Ç§„É†Ê§úË®º -->
                <div class="test-section">
                    <h3>üîÑ „É™„Ç¢„É´„Çø„Ç§„É†Ê§úË®º</h3>
                    <textarea class="test-input" id="realtime-input" placeholder="„É™„Ç¢„É´„Çø„Ç§„É†Ê§úË®º„ÅÆ„ÉÜ„Çπ„Éà..." rows="4"></textarea>
                    <div class="test-controls">
                        <button class="btn" onclick="enableRealtimeValidation()">
                            „É™„Ç¢„É´„Çø„Ç§„É†Ê§úË®º„ÇíÊúâÂäπÂåñ
                        </button>
                        <button class="btn btn-danger" onclick="disableRealtimeValidation()">
                            Ê§úË®º„ÇíÁÑ°ÂäπÂåñ
                        </button>
                    </div>
                    <div class="test-result" id="realtime-result"></div>
                </div>
            </div>
        </div>

        <!-- „Çπ„Éà„É¨„Çπ„ÉÜ„Çπ„Éà„Çø„Éñ -->
        <div class="tab-content hidden" id="tab-stress">
            <div class="test-container">
                <!-- „Çπ„Éà„É¨„Çπ„ÉÜ„Çπ„Éà -->
                <div class="test-section">
                    <h3>üî• „Çπ„Éà„É¨„Çπ„ÉÜ„Çπ„Éà</h3>
                    <div class="test-controls">
                        <button class="btn" onclick="runStressTest()">
                            „Çπ„Éà„É¨„Çπ„ÉÜ„Çπ„ÉàÈñãÂßã
                        </button>
                        <button class="btn btn-danger" onclick="stopStressTest()">
                            „ÉÜ„Çπ„ÉàÂÅúÊ≠¢
                        </button>
                        <button class="btn btn-warning" onclick="loadTest()">
                            Ë≤†Ëç∑„ÉÜ„Çπ„Éà
                        </button>
                    </div>
                    <div class="test-result" id="stress-result"></div>
                </div>

                <!-- Â§ßÈáè„Éá„Éº„Çø„ÉÜ„Çπ„Éà -->
                <div class="test-section">
                    <h3>üìä Â§ßÈáè„Éá„Éº„Çø„ÉÜ„Çπ„Éà</h3>
                    <div class="test-controls">
                        <button class="btn" onclick="testLargeInput()">
                            Â§ßÈáèÂÖ•Âäõ„ÉÜ„Çπ„Éà
                        </button>
                        <button class="btn btn-success" onclick="testConcurrentRequests()">
                            ÂêåÊôÇ„É™„ÇØ„Ç®„Çπ„Éà„ÉÜ„Çπ„Éà
                        </button>
                    </div>
                    <div class="test-result" id="largedata-result"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- „Ç≥„É≥„ÇΩ„Éº„É´„É≠„Ç∞ -->
    <div class="test-section" style="margin-top: 20px;">
        <h3>üìù „ÉÜ„Çπ„Éà„Ç≥„É≥„ÇΩ„Éº„É´</h3>
        <div class="test-controls">
            <button class="btn btn-warning" onclick="clearConsole()">
                „Ç≥„É≥„ÇΩ„Éº„É´„ÇØ„É™„Ç¢
            </button>
        </div>
        <div class="console-log" id="test-console"></div>
    </div>

    <!-- ÂøÖË¶Å„Å™„Çπ„ÇØ„É™„Éó„Éà„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø -->
    <script type="module">
        // Phase 4 „ÅÆÂêÑ„É¢„Ç∏„É•„Éº„É´„Çí„Ç§„É≥„Éù„Éº„Éà
        import { createErrorHandler } from './ErrorHandler.js';
        import { createPerformanceOptimizer } from './PerformanceOptimizer.js';
        import { createValidationEngine } from './ValidationEngine.js';

        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞„Å®„Åó„Å¶Ë®≠ÂÆö
        window.errorHandler = createErrorHandler();
        window.performanceOptimizer = createPerformanceOptimizer();
        window.validationEngine = createValidationEngine();

        // „É≠„Ç∞Âá∫ÂäõÈñ¢Êï∞
        window.testLog = function(message, type = 'info') {
            const consoleElement = document.getElementById('test-console');
            const timestamp = new Date().toLocaleTimeString();
            const logClass = `log-${type}`;
            const logMessage = `[${timestamp}] ${message}`;
            
            consoleElement.innerHTML += `<div class="${logClass}">${logMessage}</div>`;
            consoleElement.scrollTop = consoleElement.scrollHeight;
            
            // ÈÄöÂ∏∏„ÅÆ„Ç≥„É≥„ÇΩ„Éº„É´„Å´„ÇÇÂá∫Âäõ
            window.console[type === 'error' ? 'error' : type === 'warning' ? 'warn' : 'log'](logMessage);
        };

        // ÂàùÊúüÂåñÂÆå‰∫Ü„Çí„É≠„Ç∞
        testLog('Phase 4 Áµ±Âêà„ÉÜ„Çπ„Éà„Çπ„Ç§„Éº„ÉàÂàùÊúüÂåñÂÆå‰∫Ü', 'success');
        testLog('ErrorHandler, PerformanceOptimizer, ValidationEngine „ÅåË™≠„ÅøËæº„Åæ„Çå„Åæ„Åó„Åü', 'info');
    </script>

    <script>
        // „ÉÜ„Çπ„ÉàÁµ±Ë®à„ÅÆ„Ç∞„É≠„Éº„Éê„É´ÂàùÊúüÂåñ
        window.testStats = {
            total: 0,
            passed: 0,
            failed: 0,
            startTime: null,
            times: []
        };

        // „Çø„ÉñÂàá„ÇäÊõø„ÅàÊ©üËÉΩ
        document.addEventListener('DOMContentLoaded', function() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetTab = this.dataset.tab;

                    // „Éú„Çø„É≥„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÊõ¥Êñ∞
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');

                    // „Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅÆË°®Á§∫„ÇíÂàá„ÇäÊõø„Åà
                    tabContents.forEach(content => {
                        if (content.id === `tab-${targetTab}`) {
                            content.classList.remove('hidden');
                        } else {
                            content.classList.add('hidden');
                        }
                    });
                });
            });

            // „É°„Éà„É™„ÇØ„ÇπÊõ¥Êñ∞„ÅÆÈñãÂßã
            startMetricsUpdate();
        });

        // „É°„Éà„É™„ÇØ„ÇπÊõ¥Êñ∞
        function startMetricsUpdate() {
            setInterval(updateMetrics, 1000);
        }

        function updateMetrics() {
            // testStats„ÅåÊú™ÂÆöÁæ©„ÅÆÂ†¥Âêà„ÅØÂàùÊúüÂåñ
            if (!window.testStats) {
                window.testStats = {
                    total: 0,
                    passed: 0,
                    failed: 0,
                    startTime: null,
                    times: []
                };
            }

            // „ÉÜ„Çπ„ÉàÁµ±Ë®à„ÅÆÊõ¥Êñ∞
            document.getElementById('total-tests').textContent = testStats.total;
            document.getElementById('passed-tests').textContent = testStats.passed;
            document.getElementById('failed-tests').textContent = testStats.failed;
            
            const successRate = testStats.total > 0 ? 
                Math.round((testStats.passed / testStats.total) * 100) : 0;
            document.getElementById('success-rate').textContent = `${successRate}%`;
            
            const avgTime = testStats.times.length > 0 ? 
                Math.round(testStats.times.reduce((a, b) => a + b, 0) / testStats.times.length) : 0;
            document.getElementById('avg-time').textContent = `${avgTime}ms`;

            // „É°„É¢„É™‰ΩøÁî®Èáè„ÅÆÊõ¥Êñ∞
            if (performance.memory) {
                const memUsage = Math.round(performance.memory.usedJSHeapSize / 1024 / 1024);
                document.getElementById('memory-usage').textContent = `${memUsage}MB`;
            }

            // „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº„ÅÆÊõ¥Êñ∞
            const progressFill = document.getElementById('progress-fill');
            if (testStats.total > 0) {
                const progress = (testStats.passed / testStats.total) * 100;
                progressFill.style.width = `${progress}%`;
            }
        }

        // „ÉÜ„Çπ„ÉàÂÆüË°å„Éò„É´„Éë„ÉºÈñ¢Êï∞
        function runTest(testName, testFunction) {
            const startTime = performance.now();
            testStats.total++;
            
            testLog(`„ÉÜ„Çπ„ÉàÈñãÂßã: ${testName}`, 'info');

            return Promise.resolve(testFunction())
                .then(result => {
                    const endTime = performance.now();
                    const duration = Math.round(endTime - startTime);
                    testStats.times.push(duration);
                    testStats.passed++;
                    
                    testLog(`‚úÖ „ÉÜ„Çπ„ÉàÊàêÂäü: ${testName} (${duration}ms)`, 'success');
                    return { success: true, result, duration };
                })
                .catch(error => {
                    const endTime = performance.now();
                    const duration = Math.round(endTime - startTime);
                    testStats.times.push(duration);
                    testStats.failed++;
                    
                    testLog(`‚ùå „ÉÜ„Çπ„ÉàÂ§±Êïó: ${testName} (${duration}ms) - ${error.message}`, 'error');
                    return { success: false, error, duration };
                });
        }

        // Phase 4 Áµ±Âêà„ÉÜ„Çπ„Éà
        async function testPhase4Integration() {
            const resultDiv = document.getElementById('integration-result');
            resultDiv.innerHTML = '<div class="loading"></div> Phase 4 Áµ±Âêà„ÉÜ„Çπ„Éà„ÇíÂÆüË°å‰∏≠...';
            
            try {
                const results = [];
                
                // ErrorHandler „ÉÜ„Çπ„Éà
                results.push(await runTest('ErrorHandlerÂàùÊúüÂåñ', () => {
                    if (!window.errorHandler) throw new Error('ErrorHandler not initialized');
                    return window.errorHandler.getMetrics();
                }));
                
                // PerformanceOptimizer „ÉÜ„Çπ„Éà
                results.push(await runTest('PerformanceOptimizerÂàùÊúüÂåñ', () => {
                    if (!window.performanceOptimizer) throw new Error('PerformanceOptimizer not initialized');
                    return window.performanceOptimizer.getMetrics();
                }));
                
                // ValidationEngine „ÉÜ„Çπ„Éà
                results.push(await runTest('ValidationEngineÂàùÊúüÂåñ', async () => {
                    if (!window.validationEngine) throw new Error('ValidationEngine not initialized');
                    const testInput = '@startuml\nA -> B\n@enduml';
                    return await window.validationEngine.validate(testInput);
                }));
                
                // Áµ±ÂêàÊ©üËÉΩ„ÉÜ„Çπ„Éà
                results.push(await runTest('Áµ±ÂêàÊ©üËÉΩ„ÉÜ„Çπ„Éà', async () => {
                    const testInput = '@startuml\nA -> B : test message\n@enduml';
                    
                    // „Éê„É™„Éá„Éº„Ç∑„Éß„É≥ÂÆüË°å
                    const validationResult = await window.validationEngine.validate(testInput);
                    if (!validationResult.isValid) {
                        throw new Error('Validation failed');
                    }
                    
                    // „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊúÄÈÅ©ÂåñÂÆüË°å
                    const optimizationResult = await window.performanceOptimizer.optimize();
                    if (!optimizationResult.success) {
                        throw new Error('Optimization failed');
                    }
                    
                    return { validation: validationResult, optimization: optimizationResult };
                }));
                
                // ÁµêÊûú„ÅÆË°®Á§∫
                const successCount = results.filter(r => r.success).length;
                const totalTime = results.reduce((sum, r) => sum + r.duration, 0);
                
                resultDiv.className = 'test-result ' + (successCount === results.length ? 'success' : 'error');
                resultDiv.innerHTML = `
                    <h4>Phase 4 Áµ±Âêà„ÉÜ„Çπ„ÉàÁµêÊûú</h4>
                    <p><strong>ÊàêÂäü:</strong> ${successCount}/${results.length} „ÉÜ„Çπ„Éà</p>
                    <p><strong>Á∑èÂÆüË°åÊôÇÈñì:</strong> ${totalTime}ms</p>
                    <p><strong>„Çπ„ÉÜ„Éº„Çø„Çπ:</strong> ${successCount === results.length ? '‚úÖ ÂÖ®„ÉÜ„Çπ„ÉàÊàêÂäü' : '‚ùå ‰∏ÄÈÉ®„ÉÜ„Çπ„ÉàÂ§±Êïó'}</p>
                    <details>
                        <summary>Ë©≥Á¥∞ÁµêÊûú</summary>
                        <pre>${JSON.stringify(results, null, 2)}</pre>
                    </details>
                `;
                
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = `
                    <h4>Áµ±Âêà„ÉÜ„Çπ„Éà„Ç®„É©„Éº</h4>
                    <p><strong>„Ç®„É©„Éº:</strong> ${error.message}</p>
                    <details>
                        <summary>„Çπ„Çø„ÉÉ„ÇØ„Éà„É¨„Éº„Çπ</summary>
                        <pre>${error.stack}</pre>
                    </details>
                `;
                testLog(`Áµ±Âêà„ÉÜ„Çπ„Éà„Ç®„É©„Éº: ${error.message}`, 'error');
            }
        }

        // ÂÖ®Ê©üËÉΩ„ÉÜ„Çπ„Éà
        async function testAllFeatures() {
            const resultDiv = document.getElementById('allfeatures-result');
            resultDiv.innerHTML = '<div class="loading"></div> ÂÖ®Ê©üËÉΩ„ÉÜ„Çπ„Éà„ÇíÂÆüË°å‰∏≠...';
            
            try {
                const features = [
                    {
                        name: '„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞',
                        test: () => testErrorRecovery()
                    },
                    {
                        name: '„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊúÄÈÅ©Âåñ',
                        test: () => testPerformanceOptimization()
                    },
                    {
                        name: 'ÂÖ•ÂäõÊ§úË®º',
                        test: () => testInputValidation()
                    },
                    {
                        name: '„É°„É¢„É™ÁÆ°ÁêÜ',
                        test: () => testMemoryManagement()
                    },
                    {
                        name: '„Ç≠„É£„ÉÉ„Ç∑„É•Ê©üËÉΩ',
                        test: () => testCaching()
                    }
                ];
                
                const results = [];
                for (const feature of features) {
                    const result = await runTest(feature.name, feature.test);
                    results.push({ feature: feature.name, ...result });
                }
                
                const successCount = results.filter(r => r.success).length;
                const totalTime = results.reduce((sum, r) => sum + r.duration, 0);
                
                resultDiv.className = 'test-result ' + (successCount === results.length ? 'success' : 'warning');
                resultDiv.innerHTML = `
                    <h4>ÂÖ®Ê©üËÉΩ„ÉÜ„Çπ„ÉàÁµêÊûú</h4>
                    <p><strong>Ê©üËÉΩ„ÉÜ„Çπ„ÉàÊàêÂäü:</strong> ${successCount}/${results.length}</p>
                    <p><strong>Á∑èÂÆüË°åÊôÇÈñì:</strong> ${totalTime}ms</p>
                    <div style="margin-top: 10px;">
                        ${results.map(r => `
                            <div style="margin: 5px 0;">
                                ${r.success ? '‚úÖ' : '‚ùå'} ${r.feature} (${r.duration}ms)
                            </div>
                        `).join('')}
                    </div>
                `;
                
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = `<h4>ÂÖ®Ê©üËÉΩ„ÉÜ„Çπ„Éà„Ç®„É©„Éº</h4><p>${error.message}</p>`;
                testLog(`ÂÖ®Ê©üËÉΩ„ÉÜ„Çπ„Éà„Ç®„É©„Éº: ${error.message}`, 'error');
            }
        }

        // ÂÄãÂà•„ÉÜ„Çπ„ÉàÈñ¢Êï∞
        async function testErrorRecovery() {
            // „Ç®„É©„ÉºÁô∫Áîü„Å®Âæ©Êóß„ÅÆ„ÉÜ„Çπ„Éà
            const testError = new Error('Test error for recovery');
            await window.errorHandler.handleError({
                message: testError.message,
                type: 'test',
                severity: 'medium',
                error: testError
            });
            return true;
        }

        async function testPerformanceOptimization() {
            const metrics = window.performanceOptimizer.getMetrics();
            await window.performanceOptimizer.optimize();
            return metrics;
        }

        async function testInputValidation() {
            const testInput = '@startuml\nA -> B : test\n@enduml';
            const result = await window.validationEngine.validate(testInput);
            if (!result.isValid) throw new Error('Validation failed');
            return result;
        }

        async function testMemoryManagement() {
            if (!performance.memory) return true;
            
            const before = performance.memory.usedJSHeapSize;
            await window.performanceOptimizer.optimize();
            const after = performance.memory.usedJSHeapSize;
            
            return { before, after, saved: before - after };
        }

        async function testCaching() {
            // „Ç≠„É£„ÉÉ„Ç∑„É•„ÅÆ„ÉÜ„Çπ„Éà
            window.performanceOptimizer.setCache('test-key', 'test-value');
            const cached = window.performanceOptimizer.getCache('test-key');
            if (cached !== 'test-value') throw new Error('Cache test failed');
            return true;
        }

        // „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞„ÉÜ„Çπ„Éà
        async function testErrorHandling() {
            const resultDiv = document.getElementById('error-result');
            resultDiv.innerHTML = '<div class="loading"></div> „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞„ÉÜ„Çπ„Éà„ÇíÂÆüË°å‰∏≠...';
            
            try {
                const tests = [];
                
                // ÈÄöÂ∏∏„Ç®„É©„Éº„ÅÆ„ÉÜ„Çπ„Éà
                tests.push(await runTest('ÈÄöÂ∏∏„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞', async () => {
                    const error = new Error('Test error');
                    await window.errorHandler.handleError({
                        message: error.message,
                        type: 'test',
                        severity: 'low',
                        error: error
                    });
                    return true;
                }));
                
                // Ëá¥ÂëΩÁöÑ„Ç®„É©„Éº„ÅÆ„ÉÜ„Çπ„Éà
                tests.push(await runTest('Ëá¥ÂëΩÁöÑ„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞', async () => {
                    const error = new Error('Critical test error');
                    await window.errorHandler.handleError({
                        message: error.message,
                        type: 'test',
                        severity: 'critical',
                        error: error
                    });
                    return true;
                }));
                
                const successCount = tests.filter(t => t.success).length;
                const metrics = window.errorHandler.getMetrics();
                
                resultDiv.className = 'test-result success';
                resultDiv.innerHTML = `
                    <h4>„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞„ÉÜ„Çπ„ÉàÁµêÊûú</h4>
                    <p><strong>ÊàêÂäü:</strong> ${successCount}/${tests.length} „ÉÜ„Çπ„Éà</p>
                    <p><strong>Á∑è„Ç®„É©„ÉºÊï∞:</strong> ${metrics.totalErrors}</p>
                    <p><strong>Âæ©ÊóßÂèØËÉΩ„Ç®„É©„Éº:</strong> ${metrics.recoverableErrors}</p>
                    <p><strong>Ëá¥ÂëΩÁöÑ„Ç®„É©„Éº:</strong> ${metrics.fatalErrors}</p>
                `;
                
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = `<h4>„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞„ÉÜ„Çπ„Éà„Ç®„É©„Éº</h4><p>${error.message}</p>`;
                testLog(`„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞„ÉÜ„Çπ„Éà„Ç®„É©„Éº: ${error.message}`, 'error');
            }
        }

        // „ÉÜ„Çπ„Éà„Ç®„É©„Éº„ÅÆÁô∫Áîü
        function triggerTestError() {
            try {
                throw new Error('ÊÑèÂõ≥ÁöÑ„Å™„ÉÜ„Çπ„Éà„Ç®„É©„Éº');
            } catch (error) {
                testLog('„ÉÜ„Çπ„Éà„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü', 'warning');
                // „Ç®„É©„Éº„Éè„É≥„Éâ„É©„Éº„Åå„Ç≠„É£„ÉÉ„ÉÅ„Åô„Çã„ÅØ„Åö
            }
        }

        // „Åù„ÅÆ‰ªñ„ÅÆÈñ¢Êï∞„ÅØÁ∂ö„Åç„Åæ„Åô...
        function testRecovery() { testLog('Ëá™ÂãïÂæ©Êóß„ÉÜ„Çπ„Éà„ÅØÂÆüË£Ö‰∏≠„Åß„Åô', 'info'); }
        function showErrorMetrics() { 
            const metrics = window.errorHandler.getMetrics();
            document.getElementById('error-monitoring').innerHTML = `<pre>${JSON.stringify(metrics, null, 2)}</pre>`;
        }
        function clearErrors() { 
            window.errorHandler.clearErrors();
            testLog('„Ç®„É©„Éº„É≠„Ç∞„Åå„ÇØ„É™„Ç¢„Åï„Çå„Åæ„Åó„Åü', 'info');
        }

        function testPerformance() { testLog('„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉÜ„Çπ„Éà„ÅØÂÆüË£Ö‰∏≠„Åß„Åô', 'info'); }
        function optimizePerformance() { 
            window.performanceOptimizer.optimize();
            testLog('„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊúÄÈÅ©Âåñ„ÇíÂÆüË°å„Åó„Åæ„Åó„Åü', 'success');
        }
        function memoryTest() { testLog('„É°„É¢„É™„ÉÜ„Çπ„Éà„ÅØÂÆüË£Ö‰∏≠„Åß„Åô', 'info'); }
        function monitorMemory() { testLog('„É°„É¢„É™Áõ£Ë¶ñ„ÇíÈñãÂßã„Åó„Åæ„Åó„Åü', 'info'); }
        function stopMemoryMonitor() { testLog('„É°„É¢„É™Áõ£Ë¶ñ„ÇíÂÅúÊ≠¢„Åó„Åæ„Åó„Åü', 'info'); }

        async function testValidation() {
            const input = document.getElementById('validation-input').value;
            const result = await window.validationEngine.validate(input);
            document.getElementById('validation-result').innerHTML = `<pre>${JSON.stringify(result, null, 2)}</pre>`;
        }
        function testAutoCorrect() { testLog('Ëá™Âãï‰øÆÊ≠£„ÉÜ„Çπ„Éà„ÅØÂÆüË£Ö‰∏≠„Åß„Åô', 'info'); }
        function testSecurityValidation() { testLog('„Çª„Ç≠„É•„É™„ÉÜ„Ç£Ê§úË®º„ÉÜ„Çπ„Éà„ÅØÂÆüË£Ö‰∏≠„Åß„Åô', 'info'); }
        function enableRealtimeValidation() { testLog('„É™„Ç¢„É´„Çø„Ç§„É†Ê§úË®º„ÇíÊúâÂäπÂåñ„Åó„Åæ„Åó„Åü', 'success'); }
        function disableRealtimeValidation() { testLog('„É™„Ç¢„É´„Çø„Ç§„É†Ê§úË®º„ÇíÁÑ°ÂäπÂåñ„Åó„Åæ„Åó„Åü', 'warning'); }

        function runStressTest() { testLog('„Çπ„Éà„É¨„Çπ„ÉÜ„Çπ„Éà„ÇíÈñãÂßã„Åó„Åæ„Åó„Åü', 'info'); }
        function stopStressTest() { testLog('„Çπ„Éà„É¨„Çπ„ÉÜ„Çπ„Éà„ÇíÂÅúÊ≠¢„Åó„Åæ„Åó„Åü', 'warning'); }
        function loadTest() { testLog('Ë≤†Ëç∑„ÉÜ„Çπ„Éà„ÅØÂÆüË£Ö‰∏≠„Åß„Åô', 'info'); }
        function testLargeInput() { testLog('Â§ßÈáèÂÖ•Âäõ„ÉÜ„Çπ„Éà„ÅØÂÆüË£Ö‰∏≠„Åß„Åô', 'info'); }
        function testConcurrentRequests() { testLog('ÂêåÊôÇ„É™„ÇØ„Ç®„Çπ„Éà„ÉÜ„Çπ„Éà„ÅØÂÆüË£Ö‰∏≠„Åß„Åô', 'info'); }

        function runBenchmark() { 
            testLog('„Éô„É≥„ÉÅ„Éû„Éº„ÇØ„ÇíÂÆüË°å‰∏≠...', 'info');
            // Á∞°Âçò„Å™„Éô„É≥„ÉÅ„Éû„Éº„ÇØ
            const start = performance.now();
            for (let i = 0; i < 10000; i++) {
                // ‰Ωï„Çâ„Åã„ÅÆÂá¶ÁêÜ
            }
            const end = performance.now();
            testLog(`„Éô„É≥„ÉÅ„Éû„Éº„ÇØÂÆå‰∫Ü: ${Math.round(end - start)}ms`, 'success');
        }

        function resetTests() {
            testStats.total = 0;
            testStats.passed = 0;
            testStats.failed = 0;
            testStats.times = [];
            
            document.querySelectorAll('.test-result').forEach(div => {
                div.innerHTML = '';
                div.className = 'test-result';
            });
            
            testLog('„ÉÜ„Çπ„ÉàÁµêÊûú„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü', 'info');
        }

        function clearConsole() {
            document.getElementById('test-console').innerHTML = '';
            testLog('„Ç≥„É≥„ÇΩ„Éº„É´„Åå„ÇØ„É™„Ç¢„Åï„Çå„Åæ„Åó„Åü', 'info');
        }
    </script>
</body>
</html>