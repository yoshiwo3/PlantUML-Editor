<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 4 çµ±åˆãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ - PlantUML Editor</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }

        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }

        .test-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .test-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .test-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        .test-section h3 {
            color: #667eea;
            margin-top: 0;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .test-controls {
            margin-bottom: 15px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            box-shadow: 0 2px 10px rgba(255, 107, 107, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
            box-shadow: 0 2px 10px rgba(81, 207, 102, 0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffd43b 0%, #fab005 100%);
            box-shadow: 0 2px 10px rgba(255, 212, 59, 0.3);
        }

        .test-result {
            background: #f8f9fa;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #dee2e6;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }

        .test-result.success {
            background: #d4edda;
            border-left-color: #28a745;
            color: #155724;
        }

        .test-result.error {
            background: #f8d7da;
            border-left-color: #dc3545;
            color: #721c24;
        }

        .test-result.warning {
            background: #fff3cd;
            border-left-color: #ffc107;
            color: #856404;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #eee;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #51cf66, #40c057);
            width: 0%;
            transition: width 0.3s ease;
        }

        .metrics-dashboard {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .metric-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #dee2e6;
        }

        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .metric-label {
            color: #666;
            margin-top: 5px;
            font-size: 0.9em;
        }

        .test-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            resize: vertical;
            margin-bottom: 10px;
        }

        .test-output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
            max-height: 300px;
            overflow-y: auto;
        }

        .error-details {
            background: #fff5f5;
            border: 1px solid #fed7d7;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            color: #c53030;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .test-status {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 10px;
        }

        .status-passed {
            background: #d4edda;
            color: #155724;
        }

        .status-failed {
            background: #f8d7da;
            color: #721c24;
        }

        .status-running {
            background: #fff3cd;
            color: #856404;
        }

        .console-log {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .console-log .log-error {
            color: #fc8181;
        }

        .console-log .log-warning {
            color: #f6e05e;
        }

        .console-log .log-info {
            color: #63b3ed;
        }

        .console-log .log-success {
            color: #68d391;
        }

        .tab-container {
            margin-top: 20px;
        }

        .tab-buttons {
            display: flex;
            background: #f1f3f4;
            border-radius: 10px 10px 0 0;
            overflow: hidden;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 15px 25px;
            cursor: pointer;
            font-weight: 500;
            color: #666;
            transition: all 0.2s ease;
            flex: 1;
        }

        .tab-button.active {
            background: #667eea;
            color: white;
        }

        .tab-content {
            background: white;
            padding: 20px;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ§ª Phase 4 çµ±åˆãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ</h1>
        <p>ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã€å…¥åŠ›æ¤œè¨¼ã®åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆ</p>
    </div>

    <!-- ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
    <div class="metrics-dashboard">
        <h3>ğŸ“Š ãƒ†ã‚¹ãƒˆãƒ¡ãƒˆãƒªã‚¯ã‚¹</h3>
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value" id="total-tests">0</div>
                <div class="metric-label">ç·ãƒ†ã‚¹ãƒˆæ•°</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="passed-tests">0</div>
                <div class="metric-label">æˆåŠŸ</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="failed-tests">0</div>
                <div class="metric-label">å¤±æ•—</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="success-rate">0%</div>
                <div class="metric-label">æˆåŠŸç‡</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="avg-time">0ms</div>
                <div class="metric-label">å¹³å‡å®Ÿè¡Œæ™‚é–“</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="memory-usage">0MB</div>
                <div class="metric-label">ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡</div>
            </div>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
    </div>

    <!-- ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div class="tab-container">
        <div class="tab-buttons">
            <button class="tab-button active" data-tab="integration">çµ±åˆãƒ†ã‚¹ãƒˆ</button>
            <button class="tab-button" data-tab="error">ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°</button>
            <button class="tab-button" data-tab="performance">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</button>
            <button class="tab-button" data-tab="validation">å…¥åŠ›æ¤œè¨¼</button>
            <button class="tab-button" data-tab="stress">ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆ</button>
        </div>

        <!-- çµ±åˆãƒ†ã‚¹ãƒˆã‚¿ãƒ– -->
        <div class="tab-content" id="tab-integration">
            <div class="test-container">
                <!-- Phase 4 çµ±åˆãƒ†ã‚¹ãƒˆ -->
                <div class="test-section">
                    <h3>ğŸ”§ Phase 4 æ©Ÿèƒ½çµ±åˆãƒ†ã‚¹ãƒˆ</h3>
                    <div class="test-controls">
                        <button class="btn" onclick="testPhase4Integration()">
                            çµ±åˆãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
                        </button>
                        <button class="btn btn-warning" onclick="resetTests()">
                            ãƒ†ã‚¹ãƒˆçµæœã‚’ãƒªã‚»ãƒƒãƒˆ
                        </button>
                    </div>
                    <div class="test-result" id="integration-result"></div>
                </div>

                <!-- å…¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ -->
                <div class="test-section">
                    <h3>ğŸ¯ å…¨æ©Ÿèƒ½ç¶²ç¾…ãƒ†ã‚¹ãƒˆ</h3>
                    <div class="test-controls">
                        <button class="btn" onclick="testAllFeatures()">
                            å…¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
                        </button>
                        <button class="btn btn-success" onclick="runBenchmark()">
                            ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å®Ÿè¡Œ
                        </button>
                    </div>
                    <div class="test-result" id="allfeatures-result"></div>
                </div>
            </div>
        </div>

        <!-- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆã‚¿ãƒ– -->
        <div class="tab-content hidden" id="tab-error">
            <div class="test-container">
                <!-- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ -->
                <div class="test-section">
                    <h3>âš ï¸ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ</h3>
                    <div class="test-controls">
                        <button class="btn" onclick="testErrorHandling()">
                            ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ
                        </button>
                        <button class="btn btn-danger" onclick="triggerTestError()">
                            ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼ã‚’ç™ºç”Ÿ
                        </button>
                        <button class="btn btn-warning" onclick="testRecovery()">
                            è‡ªå‹•å¾©æ—§ãƒ†ã‚¹ãƒˆ
                        </button>
                    </div>
                    <div class="test-result" id="error-result"></div>
                </div>

                <!-- ã‚¨ãƒ©ãƒ¼ç›£è¦– -->
                <div class="test-section">
                    <h3>ğŸ“‹ ã‚¨ãƒ©ãƒ¼ç›£è¦–</h3>
                    <div class="test-controls">
                        <button class="btn" onclick="showErrorMetrics()">
                            ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒˆãƒªã‚¯ã‚¹è¡¨ç¤º
                        </button>
                        <button class="btn btn-danger" onclick="clearErrors()">
                            ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚¯ãƒªã‚¢
                        </button>
                    </div>
                    <div class="test-result" id="error-monitoring"></div>
                </div>
            </div>
        </div>

        <!-- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã‚¿ãƒ– -->
        <div class="tab-content hidden" id="tab-performance">
            <div class="test-container">
                <!-- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ -->
                <div class="test-section">
                    <h3>âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</h3>
                    <div class="test-controls">
                        <button class="btn" onclick="testPerformance()">
                            ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
                        </button>
                        <button class="btn btn-success" onclick="optimizePerformance()">
                            æœ€é©åŒ–å®Ÿè¡Œ
                        </button>
                        <button class="btn btn-warning" onclick="memoryTest()">
                            ãƒ¡ãƒ¢ãƒªãƒ†ã‚¹ãƒˆ
                        </button>
                    </div>
                    <div class="test-result" id="performance-result"></div>
                </div>

                <!-- ãƒ¡ãƒ¢ãƒªç›£è¦– -->
                <div class="test-section">
                    <h3>ğŸ’¾ ãƒ¡ãƒ¢ãƒªç›£è¦–</h3>
                    <div class="test-controls">
                        <button class="btn" onclick="monitorMemory()">
                            ãƒ¡ãƒ¢ãƒªç›£è¦–é–‹å§‹
                        </button>
                        <button class="btn btn-danger" onclick="stopMemoryMonitor()">
                            ç›£è¦–åœæ­¢
                        </button>
                    </div>
                    <div class="test-result" id="memory-result"></div>
                </div>
            </div>
        </div>

        <!-- å…¥åŠ›æ¤œè¨¼ãƒ†ã‚¹ãƒˆã‚¿ãƒ– -->
        <div class="tab-content hidden" id="tab-validation">
            <div class="test-container">
                <!-- å…¥åŠ›æ¤œè¨¼ãƒ†ã‚¹ãƒˆ -->
                <div class="test-section">
                    <h3>âœ… å…¥åŠ›æ¤œè¨¼ãƒ†ã‚¹ãƒˆ</h3>
                    <textarea class="test-input" id="validation-input" placeholder="æ¤œè¨¼ã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..." rows="6">@startuml
A -> B : ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
B -> C : ãƒ¬ã‚¹ãƒãƒ³ã‚¹
@enduml</textarea>
                    <div class="test-controls">
                        <button class="btn" onclick="testValidation()">
                            å…¥åŠ›æ¤œè¨¼å®Ÿè¡Œ
                        </button>
                        <button class="btn btn-success" onclick="testAutoCorrect()">
                            è‡ªå‹•ä¿®æ­£ãƒ†ã‚¹ãƒˆ
                        </button>
                        <button class="btn btn-warning" onclick="testSecurityValidation()">
                            ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¤œè¨¼
                        </button>
                    </div>
                    <div class="test-result" id="validation-result"></div>
                </div>

                <!-- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼ -->
                <div class="test-section">
                    <h3>ğŸ”„ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼</h3>
                    <textarea class="test-input" id="realtime-input" placeholder="ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼ã®ãƒ†ã‚¹ãƒˆ..." rows="4"></textarea>
                    <div class="test-controls">
                        <button class="btn" onclick="enableRealtimeValidation()">
                            ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼ã‚’æœ‰åŠ¹åŒ–
                        </button>
                        <button class="btn btn-danger" onclick="disableRealtimeValidation()">
                            æ¤œè¨¼ã‚’ç„¡åŠ¹åŒ–
                        </button>
                    </div>
                    <div class="test-result" id="realtime-result"></div>
                </div>
            </div>
        </div>

        <!-- ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆã‚¿ãƒ– -->
        <div class="tab-content hidden" id="tab-stress">
            <div class="test-container">
                <!-- ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆ -->
                <div class="test-section">
                    <h3>ğŸ”¥ ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆ</h3>
                    <div class="test-controls">
                        <button class="btn" onclick="runStressTest()">
                            ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹
                        </button>
                        <button class="btn btn-danger" onclick="stopStressTest()">
                            ãƒ†ã‚¹ãƒˆåœæ­¢
                        </button>
                        <button class="btn btn-warning" onclick="loadTest()">
                            è² è·ãƒ†ã‚¹ãƒˆ
                        </button>
                    </div>
                    <div class="test-result" id="stress-result"></div>
                </div>

                <!-- å¤§é‡ãƒ‡ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆ -->
                <div class="test-section">
                    <h3>ğŸ“Š å¤§é‡ãƒ‡ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆ</h3>
                    <div class="test-controls">
                        <button class="btn" onclick="testLargeInput()">
                            å¤§é‡å…¥åŠ›ãƒ†ã‚¹ãƒˆ
                        </button>
                        <button class="btn btn-success" onclick="testConcurrentRequests()">
                            åŒæ™‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ†ã‚¹ãƒˆ
                        </button>
                    </div>
                    <div class="test-result" id="largedata-result"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚° -->
    <div class="test-section" style="margin-top: 20px;">
        <h3>ğŸ“ ãƒ†ã‚¹ãƒˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«</h3>
        <div class="test-controls">
            <button class="btn btn-warning" onclick="clearConsole()">
                ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¯ãƒªã‚¢
            </button>
        </div>
        <div class="console-log" id="test-console"></div>
    </div>

    <!-- å¿…è¦ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ -->
    <script type="module">
        // Phase 4 ã®å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
        import { createErrorHandler } from './ErrorHandler.js';
        import { createPerformanceOptimizer } from './PerformanceOptimizer.js';
        import { createValidationEngine } from './ValidationEngine.js';

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¨ã—ã¦è¨­å®š
        window.errorHandler = createErrorHandler();
        window.performanceOptimizer = createPerformanceOptimizer();
        window.validationEngine = createValidationEngine();

        // ãƒ­ã‚°å‡ºåŠ›é–¢æ•°
        window.testLog = function(message, type = 'info') {
            const consoleElement = document.getElementById('test-console');
            const timestamp = new Date().toLocaleTimeString();
            const logClass = `log-${type}`;
            const logMessage = `[${timestamp}] ${message}`;
            
            consoleElement.innerHTML += `<div class="${logClass}">${logMessage}</div>`;
            consoleElement.scrollTop = consoleElement.scrollHeight;
            
            // é€šå¸¸ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚‚å‡ºåŠ›
            window.console[type === 'error' ? 'error' : type === 'warning' ? 'warn' : 'log'](logMessage);
        };

        // åˆæœŸåŒ–å®Œäº†ã‚’ãƒ­ã‚°
        testLog('Phase 4 çµ±åˆãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆåˆæœŸåŒ–å®Œäº†', 'success');
        testLog('ErrorHandler, PerformanceOptimizer, ValidationEngine ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ', 'info');
    </script>

    <script>
        // ãƒ†ã‚¹ãƒˆçµ±è¨ˆã®ã‚°ãƒ­ãƒ¼ãƒãƒ«åˆæœŸåŒ–
        window.testStats = {
            total: 0,
            passed: 0,
            failed: 0,
            startTime: null,
            times: []
        };

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
        document.addEventListener('DOMContentLoaded', function() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetTab = this.dataset.tab;

                    // ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');

                    // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ
                    tabContents.forEach(content => {
                        if (content.id === `tab-${targetTab}`) {
                            content.classList.remove('hidden');
                        } else {
                            content.classList.add('hidden');
                        }
                    });
                });
            });

            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°ã®é–‹å§‹
            startMetricsUpdate();
        });

        // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
        function startMetricsUpdate() {
            setInterval(updateMetrics, 1000);
        }

        function updateMetrics() {
            // testStatsãŒæœªå®šç¾©ã®å ´åˆã¯åˆæœŸåŒ–
            if (!window.testStats) {
                window.testStats = {
                    total: 0,
                    passed: 0,
                    failed: 0,
                    startTime: null,
                    times: []
                };
            }

            // ãƒ†ã‚¹ãƒˆçµ±è¨ˆã®æ›´æ–°
            document.getElementById('total-tests').textContent = testStats.total;
            document.getElementById('passed-tests').textContent = testStats.passed;
            document.getElementById('failed-tests').textContent = testStats.failed;
            
            const successRate = testStats.total > 0 ? 
                Math.round((testStats.passed / testStats.total) * 100) : 0;
            document.getElementById('success-rate').textContent = `${successRate}%`;
            
            const avgTime = testStats.times.length > 0 ? 
                Math.round(testStats.times.reduce((a, b) => a + b, 0) / testStats.times.length) : 0;
            document.getElementById('avg-time').textContent = `${avgTime}ms`;

            // ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®æ›´æ–°
            if (performance.memory) {
                const memUsage = Math.round(performance.memory.usedJSHeapSize / 1024 / 1024);
                document.getElementById('memory-usage').textContent = `${memUsage}MB`;
            }

            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®æ›´æ–°
            const progressFill = document.getElementById('progress-fill');
            if (testStats.total > 0) {
                const progress = (testStats.passed / testStats.total) * 100;
                progressFill.style.width = `${progress}%`;
            }
        }

        // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        function runTest(testName, testFunction) {
            const startTime = performance.now();
            testStats.total++;
            
            testLog(`ãƒ†ã‚¹ãƒˆé–‹å§‹: ${testName}`, 'info');

            return Promise.resolve(testFunction())
                .then(result => {
                    const endTime = performance.now();
                    const duration = Math.round(endTime - startTime);
                    testStats.times.push(duration);
                    testStats.passed++;
                    
                    testLog(`âœ… ãƒ†ã‚¹ãƒˆæˆåŠŸ: ${testName} (${duration}ms)`, 'success');
                    return { success: true, result, duration };
                })
                .catch(error => {
                    const endTime = performance.now();
                    const duration = Math.round(endTime - startTime);
                    testStats.times.push(duration);
                    testStats.failed++;
                    
                    testLog(`âŒ ãƒ†ã‚¹ãƒˆå¤±æ•—: ${testName} (${duration}ms) - ${error.message}`, 'error');
                    return { success: false, error, duration };
                });
        }

        // Phase 4 çµ±åˆãƒ†ã‚¹ãƒˆ
        async function testPhase4Integration() {
            const resultDiv = document.getElementById('integration-result');
            resultDiv.innerHTML = '<div class="loading"></div> Phase 4 çµ±åˆãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...';
            
            try {
                const results = [];
                
                // ErrorHandler ãƒ†ã‚¹ãƒˆ
                results.push(await runTest('ErrorHandleråˆæœŸåŒ–', () => {
                    if (!window.errorHandler) throw new Error('ErrorHandler not initialized');
                    return window.errorHandler.getMetrics();
                }));
                
                // PerformanceOptimizer ãƒ†ã‚¹ãƒˆ
                results.push(await runTest('PerformanceOptimizeråˆæœŸåŒ–', () => {
                    if (!window.performanceOptimizer) throw new Error('PerformanceOptimizer not initialized');
                    return window.performanceOptimizer.getMetrics();
                }));
                
                // ValidationEngine ãƒ†ã‚¹ãƒˆ
                results.push(await runTest('ValidationEngineåˆæœŸåŒ–', async () => {
                    if (!window.validationEngine) throw new Error('ValidationEngine not initialized');
                    const testInput = '@startuml\nA -> B\n@enduml';
                    return await window.validationEngine.validate(testInput);
                }));
                
                // çµ±åˆæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
                results.push(await runTest('çµ±åˆæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ', async () => {
                    const testInput = '@startuml\nA -> B : test message\n@enduml';
                    
                    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
                    const validationResult = await window.validationEngine.validate(testInput);
                    if (!validationResult.isValid) {
                        throw new Error('Validation failed');
                    }
                    
                    // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–å®Ÿè¡Œ
                    const optimizationResult = await window.performanceOptimizer.optimize();
                    if (!optimizationResult.success) {
                        throw new Error('Optimization failed');
                    }
                    
                    return { validation: validationResult, optimization: optimizationResult };
                }));
                
                // çµæœã®è¡¨ç¤º
                const successCount = results.filter(r => r.success).length;
                const totalTime = results.reduce((sum, r) => sum + r.duration, 0);
                
                resultDiv.className = 'test-result ' + (successCount === results.length ? 'success' : 'error');
                resultDiv.innerHTML = `
                    <h4>Phase 4 çµ±åˆãƒ†ã‚¹ãƒˆçµæœ</h4>
                    <p><strong>æˆåŠŸ:</strong> ${successCount}/${results.length} ãƒ†ã‚¹ãƒˆ</p>
                    <p><strong>ç·å®Ÿè¡Œæ™‚é–“:</strong> ${totalTime}ms</p>
                    <p><strong>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</strong> ${successCount === results.length ? 'âœ… å…¨ãƒ†ã‚¹ãƒˆæˆåŠŸ' : 'âŒ ä¸€éƒ¨ãƒ†ã‚¹ãƒˆå¤±æ•—'}</p>
                    <details>
                        <summary>è©³ç´°çµæœ</summary>
                        <pre>${JSON.stringify(results, null, 2)}</pre>
                    </details>
                `;
                
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = `
                    <h4>çµ±åˆãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼</h4>
                    <p><strong>ã‚¨ãƒ©ãƒ¼:</strong> ${error.message}</p>
                    <details>
                        <summary>ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹</summary>
                        <pre>${error.stack}</pre>
                    </details>
                `;
                testLog(`çµ±åˆãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // å…¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
        async function testAllFeatures() {
            const resultDiv = document.getElementById('allfeatures-result');
            resultDiv.innerHTML = '<div class="loading"></div> å…¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...';
            
            try {
                const features = [
                    {
                        name: 'ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°',
                        test: () => testErrorRecovery()
                    },
                    {
                        name: 'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–',
                        test: () => testPerformanceOptimization()
                    },
                    {
                        name: 'å…¥åŠ›æ¤œè¨¼',
                        test: () => testInputValidation()
                    },
                    {
                        name: 'ãƒ¡ãƒ¢ãƒªç®¡ç†',
                        test: () => testMemoryManagement()
                    },
                    {
                        name: 'ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½',
                        test: () => testCaching()
                    }
                ];
                
                const results = [];
                for (const feature of features) {
                    const result = await runTest(feature.name, feature.test);
                    results.push({ feature: feature.name, ...result });
                }
                
                const successCount = results.filter(r => r.success).length;
                const totalTime = results.reduce((sum, r) => sum + r.duration, 0);
                
                resultDiv.className = 'test-result ' + (successCount === results.length ? 'success' : 'warning');
                resultDiv.innerHTML = `
                    <h4>å…¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆçµæœ</h4>
                    <p><strong>æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆæˆåŠŸ:</strong> ${successCount}/${results.length}</p>
                    <p><strong>ç·å®Ÿè¡Œæ™‚é–“:</strong> ${totalTime}ms</p>
                    <div style="margin-top: 10px;">
                        ${results.map(r => `
                            <div style="margin: 5px 0;">
                                ${r.success ? 'âœ…' : 'âŒ'} ${r.feature} (${r.duration}ms)
                            </div>
                        `).join('')}
                    </div>
                `;
                
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = `<h4>å…¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼</h4><p>${error.message}</p>`;
                testLog(`å…¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // å€‹åˆ¥ãƒ†ã‚¹ãƒˆé–¢æ•°
        async function testErrorRecovery() {
            // ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿã¨å¾©æ—§ã®ãƒ†ã‚¹ãƒˆ
            const testError = new Error('Test error for recovery');
            await window.errorHandler.handleError({
                message: testError.message,
                type: 'test',
                severity: 'medium',
                error: testError
            });
            return true;
        }

        async function testPerformanceOptimization() {
            const metrics = window.performanceOptimizer.getMetrics();
            await window.performanceOptimizer.optimize();
            return metrics;
        }

        async function testInputValidation() {
            const testInput = '@startuml\nA -> B : test\n@enduml';
            const result = await window.validationEngine.validate(testInput);
            if (!result.isValid) throw new Error('Validation failed');
            return result;
        }

        async function testMemoryManagement() {
            if (!performance.memory) return true;
            
            const before = performance.memory.usedJSHeapSize;
            await window.performanceOptimizer.optimize();
            const after = performance.memory.usedJSHeapSize;
            
            return { before, after, saved: before - after };
        }

        async function testCaching() {
            // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ãƒ†ã‚¹ãƒˆ
            window.performanceOptimizer.setCache('test-key', 'test-value');
            const cached = window.performanceOptimizer.getCache('test-key');
            if (cached !== 'test-value') throw new Error('Cache test failed');
            return true;
        }

        // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ
        async function testErrorHandling() {
            const resultDiv = document.getElementById('error-result');
            resultDiv.innerHTML = '<div class="loading"></div> ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...';
            
            try {
                const tests = [];
                
                // é€šå¸¸ã‚¨ãƒ©ãƒ¼ã®ãƒ†ã‚¹ãƒˆ
                tests.push(await runTest('é€šå¸¸ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°', async () => {
                    const error = new Error('Test error');
                    await window.errorHandler.handleError({
                        message: error.message,
                        type: 'test',
                        severity: 'low',
                        error: error
                    });
                    return true;
                }));
                
                // è‡´å‘½çš„ã‚¨ãƒ©ãƒ¼ã®ãƒ†ã‚¹ãƒˆ
                tests.push(await runTest('è‡´å‘½çš„ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°', async () => {
                    const error = new Error('Critical test error');
                    await window.errorHandler.handleError({
                        message: error.message,
                        type: 'test',
                        severity: 'critical',
                        error: error
                    });
                    return true;
                }));
                
                const successCount = tests.filter(t => t.success).length;
                const metrics = window.errorHandler.getMetrics();
                
                resultDiv.className = 'test-result success';
                resultDiv.innerHTML = `
                    <h4>ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆçµæœ</h4>
                    <p><strong>æˆåŠŸ:</strong> ${successCount}/${tests.length} ãƒ†ã‚¹ãƒˆ</p>
                    <p><strong>ç·ã‚¨ãƒ©ãƒ¼æ•°:</strong> ${metrics.totalErrors}</p>
                    <p><strong>å¾©æ—§å¯èƒ½ã‚¨ãƒ©ãƒ¼:</strong> ${metrics.recoverableErrors}</p>
                    <p><strong>è‡´å‘½çš„ã‚¨ãƒ©ãƒ¼:</strong> ${metrics.fatalErrors}</p>
                `;
                
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = `<h4>ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼</h4><p>${error.message}</p>`;
                testLog(`ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼ã®ç™ºç”Ÿ
        function triggerTestError() {
            try {
                throw new Error('æ„å›³çš„ãªãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼');
            } catch (error) {
                testLog('ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'warning');
                // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãŒã‚­ãƒ£ãƒƒãƒã™ã‚‹ã¯ãš
            }
        }

        // ãã®ä»–ã®é–¢æ•°ã¯ç¶šãã¾ã™...
        function testRecovery() { testLog('è‡ªå‹•å¾©æ—§ãƒ†ã‚¹ãƒˆã¯å®Ÿè£…ä¸­ã§ã™', 'info'); }
        function showErrorMetrics() { 
            const metrics = window.errorHandler.getMetrics();
            document.getElementById('error-monitoring').innerHTML = `<pre>${JSON.stringify(metrics, null, 2)}</pre>`;
        }
        function clearErrors() { 
            window.errorHandler.clearErrors();
            testLog('ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ãŒã‚¯ãƒªã‚¢ã•ã‚Œã¾ã—ãŸ', 'info');
        }

        function testPerformance() { testLog('ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã¯å®Ÿè£…ä¸­ã§ã™', 'info'); }
        function optimizePerformance() { 
            window.performanceOptimizer.optimize();
            testLog('ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã‚’å®Ÿè¡Œã—ã¾ã—ãŸ', 'success');
        }
        function memoryTest() { testLog('ãƒ¡ãƒ¢ãƒªãƒ†ã‚¹ãƒˆã¯å®Ÿè£…ä¸­ã§ã™', 'info'); }
        function monitorMemory() { testLog('ãƒ¡ãƒ¢ãƒªç›£è¦–ã‚’é–‹å§‹ã—ã¾ã—ãŸ', 'info'); }
        function stopMemoryMonitor() { testLog('ãƒ¡ãƒ¢ãƒªç›£è¦–ã‚’åœæ­¢ã—ã¾ã—ãŸ', 'info'); }

        async function testValidation() {
            const input = document.getElementById('validation-input').value;
            const result = await window.validationEngine.validate(input);
            document.getElementById('validation-result').innerHTML = `<pre>${JSON.stringify(result, null, 2)}</pre>`;
        }
        function testAutoCorrect() { testLog('è‡ªå‹•ä¿®æ­£ãƒ†ã‚¹ãƒˆã¯å®Ÿè£…ä¸­ã§ã™', 'info'); }
        function testSecurityValidation() { testLog('ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¤œè¨¼ãƒ†ã‚¹ãƒˆã¯å®Ÿè£…ä¸­ã§ã™', 'info'); }
        function enableRealtimeValidation() { testLog('ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼ã‚’æœ‰åŠ¹åŒ–ã—ã¾ã—ãŸ', 'success'); }
        function disableRealtimeValidation() { testLog('ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼ã‚’ç„¡åŠ¹åŒ–ã—ã¾ã—ãŸ', 'warning'); }

        function runStressTest() { testLog('ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã—ãŸ', 'info'); }
        function stopStressTest() { testLog('ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆã‚’åœæ­¢ã—ã¾ã—ãŸ', 'warning'); }
        function loadTest() { testLog('è² è·ãƒ†ã‚¹ãƒˆã¯å®Ÿè£…ä¸­ã§ã™', 'info'); }
        function testLargeInput() { testLog('å¤§é‡å…¥åŠ›ãƒ†ã‚¹ãƒˆã¯å®Ÿè£…ä¸­ã§ã™', 'info'); }
        function testConcurrentRequests() { testLog('åŒæ™‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ†ã‚¹ãƒˆã¯å®Ÿè£…ä¸­ã§ã™', 'info'); }

        function runBenchmark() { 
            testLog('ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’å®Ÿè¡Œä¸­...', 'info');
            // ç°¡å˜ãªãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯
            const start = performance.now();
            for (let i = 0; i < 10000; i++) {
                // ä½•ã‚‰ã‹ã®å‡¦ç†
            }
            const end = performance.now();
            testLog(`ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å®Œäº†: ${Math.round(end - start)}ms`, 'success');
        }

        function resetTests() {
            testStats.total = 0;
            testStats.passed = 0;
            testStats.failed = 0;
            testStats.times = [];
            
            document.querySelectorAll('.test-result').forEach(div => {
                div.innerHTML = '';
                div.className = 'test-result';
            });
            
            testLog('ãƒ†ã‚¹ãƒˆçµæœã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ', 'info');
        }

        function clearConsole() {
            document.getElementById('test-console').innerHTML = '';
            testLog('ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãŒã‚¯ãƒªã‚¢ã•ã‚Œã¾ã—ãŸ', 'info');
        }
    </script>
</body>
</html>