<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>PlantUML Editor Proto - 並行処理テスト</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .result { padding: 20px; margin: 20px 0; border: 1px solid #ddd; }
        .success { background: #e8f5e9; }
        .error { background: #ffebee; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>並行処理テスト</h1>
    
    <div class="result" id="result1">
        <h2>テスト1: par/and/end構文（POSTメソッド）</h2>
        <button onclick="test1()">実行</button>
        <div id="output1"></div>
    </div>
    
    <div class="result" id="result2">
        <h2>テスト2: ノートを使った並行処理表現（POSTメソッド）</h2>
        <button onclick="test2()">実行</button>
        <div id="output2"></div>
    </div>

    <script>
        async function test1() {
            const code = `@startuml
actor 顧客
participant システム
participant 在庫管理
participant 決済処理

顧客 -> システム : 注文送信

par
  システム -> 在庫管理 : 在庫確認
  在庫管理 --> システム : 在庫OK
and
  システム -> 決済処理 : 決済実行
  決済処理 --> システム : 決済完了
end

システム --> 顧客 : 注文完了通知
@enduml`;
            
            const output = document.getElementById('output1');
            output.innerHTML = 'テスト中...';
            
            try {
                const response = await fetch('https://kroki.io/plantuml/svg', {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: code
                });
                
                if (response.ok) {
                    const svg = await response.text();
                    document.getElementById('result1').className = 'result success';
                    output.innerHTML = `<p>✓ 成功！</p>${svg}`;
                } else {
                    const error = await response.text();
                    document.getElementById('result1').className = 'result error';
                    output.innerHTML = `<p>✗ エラー: ${response.status}</p><pre>${error}</pre>`;
                }
            } catch (e) {
                document.getElementById('result1').className = 'result error';
                output.innerHTML = `<p>✗ エラー: ${e.message}</p>`;
            }
        }
        
        async function test2() {
            const code = `@startuml
actor 顧客
participant システム
participant 在庫管理
participant 決済処理

顧客 -> システム : 注文送信

note over システム, 在庫管理 : 並行処理開始
システム -> 在庫管理 : 在庫確認
在庫管理 --> システム : 在庫OK

note over システム, 決済処理 : 同時実行
システム -> 決済処理 : 決済実行
決済処理 --> システム : 決済完了

note over システム : 並行処理完了

システム --> 顧客 : 注文完了通知
@enduml`;
            
            const output = document.getElementById('output2');
            output.innerHTML = 'テスト中...';
            
            try {
                const response = await fetch('https://kroki.io/plantuml/svg', {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: code
                });
                
                if (response.ok) {
                    const svg = await response.text();
                    document.getElementById('result2').className = 'result success';
                    output.innerHTML = `<p>✓ 成功！</p>${svg}`;
                } else {
                    const error = await response.text();
                    document.getElementById('result2').className = 'result error';
                    output.innerHTML = `<p>✗ エラー: ${response.status}</p><pre>${error}</pre>`;
                }
            } catch (e) {
                document.getElementById('result2').className = 'result error';
                output.innerHTML = `<p>✗ エラー: ${e.message}</p>`;
            }
        }
    </script>
</body>
</html>