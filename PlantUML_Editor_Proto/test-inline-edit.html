<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="modal-styles.css">
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <h1>ğŸ”¬ ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h1>
        </header>

        <main class="main-content">
            <section class="editor-panel">
                <div class="editor-section">
                    <h3>ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª</h3>
                    
                    <div style="margin: 20px 0;">
                        <button id="test-condition" class="btn-primary" style="margin: 10px;">
                            ğŸ”€ æ¡ä»¶åˆ†å²ç·¨é›†ãƒ†ã‚¹ãƒˆ
                        </button>
                        <button id="test-loop" class="btn-primary" style="margin: 10px;">
                            ğŸ” ãƒ«ãƒ¼ãƒ—ç·¨é›†ãƒ†ã‚¹ãƒˆ
                        </button>
                        <button id="test-parallel" class="btn-primary" style="margin: 10px;">
                            âš¡ ä¸¦è¡Œå‡¦ç†ç·¨é›†ãƒ†ã‚¹ãƒˆ
                        </button>
                    </div>

                    <div id="test-results" style="margin: 20px; padding: 20px; background: #f5f5f5; border-radius: 8px;">
                        <h4>ãƒ†ã‚¹ãƒˆçµæœ</h4>
                        <div id="results-content">
                            ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
                        </div>
                    </div>

                    <!-- å‡¦ç†ãƒ•ãƒ­ãƒ¼è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                    <div id="action-list" class="action-list" style="margin: 20px;">
                        <!-- ã“ã“ã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ -->
                    </div>
                </div>
            </section>

            <section class="preview-panel">
                <div class="preview-header">
                    <h3>PlantUMLã‚³ãƒ¼ãƒ‰</h3>
                </div>
                <div class="preview-content">
                    <pre id="plantuml-code" class="code-output">@startuml
@enduml</pre>
                </div>
            </section>
        </main>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ç”¨ã®divï¼ˆå‹•çš„ã«ä½œæˆã•ã‚Œã‚‹ï¼‰ -->
    <div id="editModal"></div>

    <script src="PlantUMLParser.js"></script>
    <script src="app.js"></script>
    <script>
        // ãƒ†ã‚¹ãƒˆç”¨ã®editorã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
        const editor = new PlantUMLEditor();
        window.editor = editor;

        // ãƒ†ã‚¹ãƒˆç”¨ã®ã‚¢ã‚¯ã‚¿ãƒ¼è¿½åŠ 
        editor.actors = ['User', 'System', 'Database', 'API'];
        
        // ãƒ†ã‚¹ãƒˆç”¨ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ 
        function setupTestData() {
            editor.actions = [
                {
                    type: 'condition',
                    conditionType: 'if-else',
                    conditionName: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼',
                    trueBranch: [
                        { from: 'System', to: 'Database', text: 'èªè¨¼æƒ…å ±ç¢ºèª', async: false },
                        { from: 'Database', to: 'System', text: 'èªè¨¼OK', async: false }
                    ],
                    falseBranch: [
                        { from: 'System', to: 'User', text: 'èªè¨¼å¤±æ•—', async: false }
                    ]
                },
                {
                    type: 'loop',
                    loopCondition: 'ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã™ã‚‹é–“',
                    loopActions: [
                        { from: 'System', to: 'Database', text: 'æ¬¡ã®ãƒ‡ãƒ¼ã‚¿å–å¾—', async: false },
                        { from: 'Database', to: 'System', text: 'ãƒ‡ãƒ¼ã‚¿è¿”å´', async: false }
                    ]
                },
                {
                    type: 'parallel',
                    branches: [
                        [
                            { from: 'System', to: 'API', text: 'API1å‘¼ã³å‡ºã—', async: true },
                            { from: 'API', to: 'System', text: 'çµæœ1è¿”å´', async: true }
                        ],
                        [
                            { from: 'System', to: 'Database', text: 'DBæ›´æ–°', async: true },
                            { from: 'Database', to: 'System', text: 'æ›´æ–°å®Œäº†', async: true }
                        ]
                    ]
                }
            ];
            
            editor.updateActionList();
            editor.updatePlantUML();
        }

        // ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.getElementById('test-condition').addEventListener('click', () => {
            setupTestData();
            const resultsDiv = document.getElementById('results-content');
            resultsDiv.innerHTML = '<p>æ¡ä»¶åˆ†å²ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ãã¾ã™...</p>';
            
            // æ¡ä»¶åˆ†å²ã‚’ç·¨é›†
            editor.editCondition(0);
            
            setTimeout(() => {
                const modal = document.querySelector('.modal-overlay');
                if (modal) {
                    resultsDiv.innerHTML += '<p>âœ… ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸ</p>';
                    
                    // ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†è¦ç´ ã®ç¢ºèª
                    const inlineItems = modal.querySelectorAll('.action-item-inline');
                    resultsDiv.innerHTML += `<p>ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†è¦ç´ : ${inlineItems.length}å€‹</p>`;
                    
                    // å„è¦ç´ ã®ç¢ºèª
                    const hasFromSelect = modal.querySelector('.actor-select-inline.from-actor');
                    const hasArrowSelect = modal.querySelector('.arrow-type-inline');
                    const hasToSelect = modal.querySelector('.actor-select-inline.to-actor');
                    const hasMessageInput = modal.querySelector('.message-input-inline');
                    const hasDeleteBtn = modal.querySelector('.btn-inline.delete');
                    const hasQuestionBtn = modal.querySelector('.btn-inline.question');
                    const hasAddBtn = modal.querySelector('.btn-add-action-inline');
                    
                    resultsDiv.innerHTML += `
                        <ul>
                            <li>FROMé¸æŠ: ${hasFromSelect ? 'âœ…' : 'âŒ'}</li>
                            <li>çŸ¢å°é¸æŠ: ${hasArrowSelect ? 'âœ…' : 'âŒ'}</li>
                            <li>TOé¸æŠ: ${hasToSelect ? 'âœ…' : 'âŒ'}</li>
                            <li>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ›: ${hasMessageInput ? 'âœ…' : 'âŒ'}</li>
                            <li>å‰Šé™¤ãƒœã‚¿ãƒ³: ${hasDeleteBtn ? 'âœ…' : 'âŒ'}</li>
                            <li>ï¼Ÿãƒœã‚¿ãƒ³: ${hasQuestionBtn ? 'âœ…' : 'âŒ'}</li>
                            <li>è¿½åŠ ãƒœã‚¿ãƒ³: ${hasAddBtn ? 'âœ…' : 'âŒ'}</li>
                        </ul>
                    `;
                } else {
                    resultsDiv.innerHTML += '<p>âŒ ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ</p>';
                }
            }, 500);
        });

        document.getElementById('test-loop').addEventListener('click', () => {
            setupTestData();
            const resultsDiv = document.getElementById('results-content');
            resultsDiv.innerHTML = '<p>ãƒ«ãƒ¼ãƒ—ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ãã¾ã™...</p>';
            
            // ãƒ«ãƒ¼ãƒ—ã‚’ç·¨é›†
            editor.editLoop(1);
            
            setTimeout(() => {
                const modal = document.querySelector('.modal-overlay');
                if (modal) {
                    resultsDiv.innerHTML += '<p>âœ… ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸ</p>';
                    
                    // ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†è¦ç´ ã®ç¢ºèª
                    const inlineItems = modal.querySelectorAll('.action-item-inline');
                    resultsDiv.innerHTML += `<p>ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†è¦ç´ : ${inlineItems.length}å€‹</p>`;
                } else {
                    resultsDiv.innerHTML += '<p>âŒ ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ</p>';
                }
            }, 500);
        });

        document.getElementById('test-parallel').addEventListener('click', () => {
            setupTestData();
            const resultsDiv = document.getElementById('results-content');
            resultsDiv.innerHTML = '<p>ä¸¦è¡Œå‡¦ç†ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ãã¾ã™...</p>';
            
            // ä¸¦è¡Œå‡¦ç†ã‚’ç·¨é›†
            editor.editParallel(2);
            
            setTimeout(() => {
                const modal = document.querySelector('.modal-overlay');
                if (modal) {
                    resultsDiv.innerHTML += '<p>âœ… ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸ</p>';
                    
                    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã‚µã‚¤ã‚ºç¢ºèª
                    const modalDialog = modal.querySelector('.modal-dialog');
                    if (modalDialog) {
                        const width = modalDialog.style.maxWidth || 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ';
                        resultsDiv.innerHTML += `<p>ãƒ¢ãƒ¼ãƒ€ãƒ«å¹…: ${width}</p>`;
                    }
                    
                    // ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†è¦ç´ ã®ç¢ºèª
                    const inlineItems = modal.querySelectorAll('.action-item-inline');
                    resultsDiv.innerHTML += `<p>ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†è¦ç´ : ${inlineItems.length}å€‹</p>`;
                    
                    // ãƒ–ãƒ©ãƒ³ãƒæ•°ã®ç¢ºèª
                    const branches = modal.querySelectorAll('.parallel-branch');
                    resultsDiv.innerHTML += `<p>ãƒ–ãƒ©ãƒ³ãƒæ•°: ${branches.length}å€‹</p>`;
                    
                    // è¦‹åˆ‡ã‚Œãƒã‚§ãƒƒã‚¯
                    const branchesContainer = modal.querySelector('#edit-parallel-branches');
                    if (branchesContainer) {
                        const hasOverflow = branchesContainer.scrollWidth > branchesContainer.clientWidth;
                        resultsDiv.innerHTML += `<p>æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«: ${hasOverflow ? 'âŒ è¦‹åˆ‡ã‚Œã‚ã‚Š' : 'âœ… è¦‹åˆ‡ã‚Œãªã—'}</p>`;
                    }
                } else {
                    resultsDiv.innerHTML += '<p>âŒ ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ</p>';
                }
            }, 500);
        });

        // åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        setupTestData();
    </script>

    <style>
        .btn-primary {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }
        
        .btn-primary:hover {
            background: #0056b3;
        }
    </style>
</body>
</html>