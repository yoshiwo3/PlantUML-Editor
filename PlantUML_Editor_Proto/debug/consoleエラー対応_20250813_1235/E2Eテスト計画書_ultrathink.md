# E2Eテスト計画書 - PlantUML Editor Proto (ultrathink レベル)

## 📋 テスト概要

**対象アプリケーション**: PlantUML Editor Proto  
**対象URL**: http://localhost:8080/index.html  
**テスト実行日**: 2025-08-13  
**テストレベル**: ultrathink（超詳細レベル）  
**予定テストシナリオ数**: 40+  

## 🎯 テスト目的

1. **基本機能の動作確認** - 報告されている「基本的な動作が全くできなくなった」問題の根本原因特定
2. **CORS対策システムの検証** - file://アクセス時の警告システム動作確認
3. **UI/UX要素の完全性確認** - 全インターフェース要素の存在・機能確認
4. **JavaScript モジュール読み込み検証** - ES6モジュールの正常ロード確認
5. **エラーハンドリング検証** - 各種エラーケースでの適切な処理確認
6. **統合機能検証** - draw.io連携、プリセットパターン等の高度機能確認

## 🔍 テスト環境・前提条件

### 必須環境
- **ブラウザ**: Microsoft Edge (Playwright MCP)
- **サーバー**: Python HTTP Server (ポート8080)
- **プロトコル**: HTTP (http://localhost:8080)
- **JavaScript**: ES6モジュール対応

### 事前確認項目
- [ ] HTTPサーバーが正常に起動している
- [ ] 対象ポート8080が使用可能
- [ ] Playwrightブラウザが利用可能
- [ ] ネットワーク接続が正常

## 📝 テストシナリオ詳細

### 🌟 【カテゴリA: 基本機能・初期化テスト (10シナリオ)】

#### A1. ページ基本読み込みテスト
**目的**: ページが正常に読み込まれ、基本構造が表示されることを確認
**手順**:
1. http://localhost:8080/index.html にアクセス
2. ページタイトルが「PlantUML変換エディター」であることを確認
3. メインコンテンツ要素 `.app-container` の存在確認
4. ヘッダー、メインパネル、ステータスバーの存在確認

**期待結果**: 全要素が適切に表示され、レイアウトが正常

#### A2. CSS読み込み・スタイル適用テスト
**目的**: スタイルシートが正常に読み込まれ、デザインが適用されていることを確認
**手順**:
1. ページアクセス後、各UI要素のスタイル確認
2. ヘッダーの背景色・フォント確認
3. ボタンスタイル・ホバー効果確認
4. レスポンシブデザイン確認（画面サイズ変更）

**期待結果**: 全スタイルが適切に適用されている

#### A3. JavaScript基本実行テスト
**目的**: JavaScriptが正常に実行され、基本イベントが動作することを確認
**手順**:
1. ページ読み込み完了待機
2. コンソールログで基本JS実行確認
3. ボタンクリックイベント応答確認
4. DOM操作イベント確認

**期待結果**: JavaScript が正常実行され、イベントハンドラが動作

#### A4. ES6モジュール読み込みテスト
**目的**: 全ES6モジュールが正常に読み込まれることを確認
**手順**:
1. DevToolsコンソールでモジュールロード状況確認
2. 以下モジュールの読み込み確認:
   - TokenTypes.js
   - ASTTypes.js
   - PlantUMLASTParser.js
   - IDManager.js
   - ASTToGUIConverter.js
   - RealtimeSyncManager.js
   - DiffCalculator.js
   - CursorStateManager.js
   - ErrorHandler.js
   - PerformanceOptimizer.js
   - ValidationEngine.js
   - drawio-converter.js
   - app.js

**期待結果**: 全モジュールが正常読み込み、エラーなし

#### A5. CORS警告システム動作テスト（HTTP接続）
**目的**: HTTP接続時にCORS警告が適切に非表示になることを確認
**手順**:
1. http://localhost:8080 でアクセス
2. CORS警告要素 `#cors-warning` の表示状態確認
3. プロトコル検出ロジック動作確認
4. アプリケーション本体の操作性確認

**期待結果**: CORS警告非表示、アプリ本体正常動作

#### A6. 初期ステータス表示テスト
**目的**: 初期状態でのステータス表示が正しいことを確認
**手順**:
1. ページ読み込み後のステータスバー確認
2. 「準備完了」メッセージ表示確認
3. アクター数・メッセージ数の初期値確認
4. タイムスタンプ表示確認

**期待結果**: "✅ 準備完了", "アクター: 0 | メッセージ: 0" 表示

#### A7. メニューボタン存在確認テスト
**目的**: ヘッダーの全機能ボタンが存在し、アクセス可能であることを確認
**手順**:
1. ヘッダー内ボタン要素確認:
   - 🗑️ クリアボタン
   - 🔷 draw.ioボタン
   - 📋 プリセットボタン
   - ⚙️ 設定ボタン
   - ❓ ヘルプボタン
   - 📖 用語説明ボタン
2. 各ボタンのクリック可能性確認

**期待結果**: 全ボタンが表示され、クリック可能

#### A8. パネルレイアウト確認テスト
**目的**: 3パネル構成が正しく表示されることを確認
**手順**:
1. 左パネル（エディターパネル）表示確認
2. 中央パネル（コードパネル）表示確認  
3. 右パネル（プレビューパネル）表示確認
4. リサイズハンドル表示確認
5. パネル幅の初期値確認

**期待結果**: 3パネルが適切に配置され、リサイズ可能

#### A9. プレースホルダー表示テスト
**目的**: 初期状態でのプレースホルダーが適切に表示されることを確認
**手順**:
1. プレビューパネルのプレースホルダー確認
2. コードエディタのプレースホルダー確認
3. テキスト内容・スタイル確認

**期待結果**: 「アクターを選択して処理を追加すると...」等が表示

#### A10. ページ読み込み完了イベントテスト
**目的**: DOMContentLoadedイベントが正常に発火し、初期化処理が完了することを確認
**手順**:
1. ページアクセス
2. コンソールでDOMContentLoadedイベント発火確認
3. 初期化処理完了確認
4. Phase A対策テストの実行確認

**期待結果**: 全初期化処理が正常完了

### 🎭 【カテゴリB: UI要素・操作性テスト (12シナリオ)】

#### B1. モード切替タブ動作テスト
**目的**: アクター+処理モードとパターン選択モードの切り替えが正常動作することを確認
**手順**:
1. 初期状態で「アクター＋処理」タブがアクティブ確認
2. 「パターン選択」タブクリック
3. コンテンツエリア切り替え確認
4. アクティブタブスタイル変更確認
5. 再度「アクター＋処理」タブクリックで戻ることを確認

**期待結果**: タブ切り替えが正常動作、コンテンツが適切に表示

#### B2. アクター選択機能テスト
**目的**: 事前定義アクターの選択機能が正常動作することを確認
**手順**:
1. アクター選択エリアで以下のアクターボタン確認:
   - 顧客 (👤)
   - 管理者 (👨‍💼)
   - ECサイト (🛒)
   - 在庫システム (📦)
   - 決済サービス (💳)
   - 配送業者 (🚚)
2. 各アクターボタンクリックで選択状態変更確認
3. 選択中アクター表示エリア更新確認

**期待結果**: 全アクターが選択可能、選択状態が適切に表示

#### B3. カスタムアクター追加テスト
**目的**: カスタムアクター追加機能が正常動作することを確認
**手順**:
1. 「➕ 追加」ボタンクリック
2. カスタムアクターモーダル表示確認
3. アクター名入力（例: "外部API"）
4. 「追加」ボタンクリック
5. 新アクターがアクター選択エリアに追加されることを確認
6. キャンセル操作も確認

**期待結果**: カスタムアクターが正常に追加され、選択可能

#### B4. 処理タイプ選択テスト
**目的**: 4種類の処理タイプ切り替えが正常動作することを確認
**手順**:
1. 初期状態で「📨 メッセージ」が選択されていることを確認
2. 「🔀 条件分岐」タブクリックし、条件分岐入力UIが表示されることを確認
3. 「🔁 ループ」タブクリックし、ループ入力UIが表示されることを確認
4. 「⚡ 並行処理」タブクリックし、並行処理入力UIが表示されることを確認
5. 各タブ切り替え時の表示内容変更確認

**期待結果**: 4つの処理タイプが適切に切り替わり、対応UIが表示

#### B5. メッセージ入力機能テスト
**目的**: 基本的なメッセージ入力機能が正常動作することを確認
**手順**:
1. 送信元アクター選択（例: 顧客）
2. 送信先アクター選択（例: システム）
3. 処理内容入力（例: "ログイン要求"）
4. オプション設定（未確定、非同期）動作確認
5. 「➕ 追加」ボタンクリック
6. 処理フローリストに追加されることを確認

**期待結果**: メッセージが正常に追加され、フローリストに表示

#### B6. 条件分岐入力機能テスト
**目的**: 条件分岐入力機能が正常動作することを確認
**手順**:
1. 条件分岐タブ選択
2. 条件タイプ選択（分岐/オプション）
3. 条件名入力（例: "在庫あり"）
4. 真の場合のアクション追加
5. 偽の場合のアクション追加（分岐の場合）
6. 条件分岐追加実行

**期待結果**: 条件分岐が正常に設定され、フローに追加

#### B7. ループ入力機能テスト
**目的**: ループ入力機能が正常動作することを確認
**手順**:
1. ループタブ選択
2. ループ条件入力（例: "全商品処理完了まで"）
3. ループ内アクション追加
4. ループ追加実行
5. フローリストでのループ表示確認

**期待結果**: ループが正常に設定され、フローに追加

#### B8. 並行処理入力機能テスト
**目的**: 並行処理入力機能が正常動作することを確認
**手順**:
1. 並行処理タブ選択
2. 並行処理1にアクション追加
3. 並行処理2にアクション追加
4. 「➕ 並行処理を追加」で分岐追加
5. 並行処理追加実行
6. フローリストでの並行処理表示確認

**期待結果**: 並行処理が正常に設定され、フローに追加

#### B9. プリセットパターン表示テスト
**目的**: パターン選択モードでプリセットパターンが正常表示されることを確認
**手順**:
1. パターン選択モード切り替え
2. カテゴリフィルター動作確認（すべて/EC系/承認系/在庫系）
3. 各パターンカード表示確認:
   - EC注文フロー
   - 承認ワークフロー
   - 在庫管理フロー
   - 並行処理フロー
   - その他20+パターン
4. パターンプレビューSVG表示確認

**期待結果**: 全パターンが適切に表示され、フィルタリング機能動作

#### B10. パターン選択・適用テスト
**目的**: プリセットパターンの選択・適用機能が正常動作することを確認
**手順**:
1. 任意のパターン（例: EC注文フロー）選択
2. 「このパターンを使用」ボタンクリック
3. アクター+処理モードに自動切り替わることを確認
4. 選択パターンのアクター・処理が適用されることを確認
5. コードパネルにPlantUMLコード生成確認

**期待結果**: パターンが正常適用され、コードが生成される

#### B11. コードエディタ操作テスト
**目的**: PlantUMLコードエディタの基本操作が正常動作することを確認
**手順**:
1. コードエディタ内直接編集テスト
2. 行番号表示確認
3. シンタックスハイライト確認（もしあれば）
4. コピーボタン動作確認
5. 整形ボタン動作確認
6. 検証ボタン動作確認
7. 同期ボタン動作確認

**期待結果**: 全コードエディタ機能が正常動作

#### B12. プレビューパネル操作テスト
**目的**: プレビューパネルの操作機能が正常動作することを確認
**手順**:
1. ズームイン/ズームアウトボタン動作確認
2. ズームレベル表示更新確認
3. 保存ボタン動作確認
4. draw.ioダウンロードボタン動作確認
5. SVGプレビュー表示確認

**期待結果**: 全プレビュー操作機能が正常動作

### 🔄 【カテゴリC: 機能統合・生成テスト (8シナリオ)】

#### C1. PlantUMLコード生成テスト
**目的**: アクター・処理入力からPlantUMLコードが正常生成されることを確認
**手順**:
1. アクター選択（顧客、システム）
2. 基本メッセージ追加（顧客 -> システム: ログイン）
3. コードパネルでPlantUMLコード自動生成確認
4. 生成コードの文法正確性確認
5. @startuml/@enduml タグ確認

**期待結果**: 正しいPlantUMLコードが自動生成される

#### C2. リアルタイム同期テスト
**目的**: GUI操作とコード編集のリアルタイム双方向同期が動作することを確認
**手順**:
1. GUI でアクター・メッセージ追加
2. コードパネルで対応するコード自動生成確認
3. コードパネルで直接編集
4. GUI側の反映確認（逆方向同期）
5. 同期の遅延・エラー有無確認

**期待結果**: GUI↔コード間の双方向同期が正常動作

#### C3. 複雑フロー生成テスト
**目的**: 条件分岐・ループ・並行処理を含む複雑なフローが正常生成されることを確認
**手順**:
1. 基本メッセージ追加
2. 条件分岐追加（在庫確認）
3. ループ追加（在庫処理）
4. 並行処理追加（決済・配送）
5. 生成されるPlantUMLコードの複雑性確認
6. プレビューでの表示確認

**期待結果**: 複雑なPlantUMLコードが正確生成され、プレビュー表示される

#### C4. プレビュー生成・表示テスト
**目的**: PlantUMLコードからSVGプレビューが正常生成・表示されることを確認
**手順**:
1. 有効なPlantUMLコード入力/生成
2. プレビューパネルでSVG生成待機
3. Kroki API呼び出し成功確認
4. SVG画像の正常表示確認
5. エラー時のエラーメッセージ表示確認

**期待結果**: SVGプレビューが正常生成・表示される

#### C5. エラーハンドリングテスト
**目的**: 無効なPlantUMLコードやAPI エラー時の適切な処理を確認
**手順**:
1. 故意に無効なPlantUMLコード入力
2. エラーメッセージ表示確認
3. ネットワークエラー時の処理確認
4. API呼び出し失敗時のフォールバック確認
5. ユーザーへの適切な通知確認

**期待結果**: エラーが適切に処理され、ユーザーに分かりやすく通知される

#### C6. パフォーマンステスト
**目的**: 大量データや複雑フロー時のパフォーマンスを確認
**手順**:
1. 大量アクター追加（10+個）
2. 複数の複雑フロー追加（50+メッセージ）
3. リアルタイム同期の応答性確認
4. プレビュー生成時間測定
5. ブラウザメモリ使用量確認

**期待結果**: 大量データでも適切なパフォーマンスを維持

#### C7. データ永続化テスト
**目的**: 作業内容の保存・復元機能を確認
**手順**:
1. 複雑なフロー作成
2. ブラウザリロード
3. データ復元確認（localStorage等）
4. 作業継続可能性確認

**期待結果**: 作業内容が適切に保存・復元される

#### C8. 全機能統合テスト
**目的**: 全機能を組み合わせた統合シナリオの動作確認
**手順**:
1. カスタムアクター追加
2. プリセットパターン適用
3. 手動で条件分岐・ループ追加
4. draw.io連携実行
5. プレビュー生成・保存
6. ページリロード後の復元確認

**期待結果**: 全機能が統合して正常動作

### 🚨 【カテゴリD: CORS・セキュリティテスト (5シナリオ)】

#### D1. HTTP接続時のCORS警告非表示テスト
**目的**: HTTP接続時にCORS警告が適切に非表示になることを確認
**手順**:
1. http://localhost:8080 でアクセス
2. `#cors-warning` 要素の display: none 確認
3. プロトコル検出ログ確認
4. メインアプリケーションの操作性確認

**期待結果**: CORS警告非表示、アプリ正常動作

#### D2. file://プロトコル警告システムテスト（シミュレーション）
**目的**: file://プロトコル検出時の警告システム動作を確認
**手順**:
1. DevTools で window.location.protocol を 'file:' に変更
2. CORS警告表示シミュレーション
3. 警告メッセージ内容確認
4. 起動ガイド表示機能確認
5. コマンドコピー機能確認

**期待結果**: file://時の警告システムが正常動作

#### D3. ES6モジュール読み込みエラー検出テスト
**目的**: ES6モジュール読み込み失敗時のエラー検出機能を確認
**手順**:
1. 故意にモジュールパスを無効化
2. モジュール読み込みエラー発生確認
3. エラーイベントリスナー動作確認
4. エラー時の追加警告表示確認

**期待結果**: モジュールエラーが適切に検出・処理される

#### D4. フォールバックモード動作テスト
**目的**: モジュール読み込み失敗時のフォールバックモード動作確認
**手順**:
1. フォールバックモード有効化
2. PlantUMLEditorLite 利用可能性確認
3. 基本機能の代替実装動作確認
4. 制限機能の適切な通知確認

**期待結果**: フォールバックモードが適切に動作

#### D5. セキュリティ・XSS耐性テスト
**目的**: ユーザー入力に対するXSS攻撃耐性を確認
**手順**:
1. カスタムアクター名に悪意のあるスクリプト入力
2. メッセージ内容に HTML タグ入力
3. 適切なエスケープ処理確認
4. XSS攻撃の無効化確認

**期待結果**: 悪意のある入力が適切にエスケープされ、XSS攻撃が無効化される

### 🔧 【カテゴリE: 高度機能・統合テスト (8シナリオ)】

#### E1. draw.io連携機能テスト
**目的**: draw.io連携機能が正常動作することを確認
**手順**:
1. PlantUMLコード生成
2. 「🔷 draw.io」ボタンクリック
3. draw.io形式への変換確認
4. 外部draw.ioアプリケーション連携確認
5. ファイルダウンロード機能確認

**期待結果**: draw.io連携が正常動作し、ファイル生成される

#### E2. 技術用語説明モーダルテスト
**目的**: 技術用語説明機能が正常動作することを確認
**手順**:
1. 「📖 用語説明」ボタンクリック
2. 用語説明モーダル表示確認
3. 各用語セクション表示確認:
   - 基本構造
   - 制御構造
   - メッセージ種類
   - その他記法
4. PlantUMLプレビュー生成確認
5. モーダル閉じる機能確認

**期待結果**: 用語説明モーダルが正常動作し、内容が適切に表示される

#### E3. キーボードショートカットテスト
**目的**: キーボードショートカット機能を確認
**手順**:
1. Ctrl+S (保存) ショートカット確認
2. Ctrl+Z (アンドゥ) ショートカット確認
3. Ctrl+Y (リドゥ) ショートカット確認
4. Tab/Shift+Tab (フォーカス移動) 確認
5. Enter (実行) ショートカット確認

**期待結果**: 主要キーボードショートカットが正常動作

#### E4. アクセシビリティテスト
**目的**: アクセシビリティ対応を確認
**手順**:
1. キーボードナビゲーション確認
2. フォーカス表示確認
3. ARIA ラベル確認
4. スクリーンリーダー対応確認
5. 高コントラストモード対応確認

**期待結果**: アクセシビリティ要件が適切に実装されている

#### E5. レスポンシブデザインテスト
**目的**: 異なる画面サイズでの表示・動作を確認
**手順**:
1. デスクトップサイズ (1920x1080) 表示確認
2. タブレットサイズ (768x1024) 表示確認
3. スマートフォンサイズ (375x667) 表示確認
4. 極小画面 (320x568) 表示確認
5. 各サイズでの操作性確認

**期待結果**: 全画面サイズで適切に表示され、操作可能

#### E6. 多言語対応テスト（将来対応）
**目的**: 多言語対応の基盤が整備されていることを確認
**手順**:
1. 言語切り替え機能の有無確認
2. テキストのハードコーディング確認
3. 国際化対応の基盤確認

**期待結果**: 多言語対応の基盤が整備されている

#### E7. ブラウザ互換性テスト
**目的**: 主要ブラウザでの動作確認
**手順**:
1. Chrome での動作確認
2. Firefox での動作確認
3. Safari での動作確認（可能であれば）
4. Edge での動作確認

**期待結果**: 主要ブラウザで正常動作

#### E8. 長時間使用・メモリリークテスト
**目的**: 長時間使用時のメモリリークやパフォーマンス劣化を確認
**手順**:
1. 1時間の連続使用シミュレーション
2. 大量操作実行（1000+アクション）
3. メモリ使用量推移確認
4. パフォーマンス劣化有無確認
5. ガベージコレクション動作確認

**期待結果**: 長時間使用でもメモリリークなし、安定動作

## 📊 テスト実行方法

### 実行手順
1. **事前準備**
   - HTTPサーバー起動確認
   - Playwright MCP 接続確認
   - テスト環境準備

2. **段階的実行**
   - カテゴリA（基本機能）から順次実行
   - 各テストシナリオの結果記録
   - 問題発見時の詳細調査

3. **結果記録**
   - 各テストの成功/失敗記録
   - エラー発生時の詳細ログ
   - スクリーンショット取得
   - 改善提案記録

### 判定基準
- **Pass**: 期待結果通りの動作
- **Fail**: 期待結果と異なる動作
- **Warning**: 一部制限があるが基本動作可能
- **Skip**: 環境制約等により実行不可

### 重要度分類
- **Critical**: 基本機能に関わる重要テスト
- **High**: 主要機能に関わるテスト
- **Medium**: 便利機能に関わるテスト
- **Low**: 付加機能に関わるテスト

## 🎯 期待される成果

1. **基本動作問題の完全解明**
2. **CORS対策システムの効果確認**
3. **UI/UX機能の全面検証**
4. **JavaScript モジュール安定性確認**
5. **統合機能の品質確認**
6. **パフォーマンス・セキュリティ確認**

## 📝 備考

- 本テストは包括的なE2Eテストとして設計されており、製品品質の全面的な検証を目的とする
- テスト実行中に発見された問題は即座に記録し、開発チームへフィードバックする
- テスト結果は後続の開発・改善計画に活用される
- ultrathinkレベルとして、細部までの徹底的な検証を実施する

---
**テスト計画書作成日**: 2025-08-13  
**最終更新日**: 2025-08-13  
**計画書バージョン**: 1.0-ultrathink