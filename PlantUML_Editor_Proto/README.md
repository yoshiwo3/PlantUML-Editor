# PlantUML変換エディター プロトタイプ

## 概要
EC/SaaS運用担当者向けのPlantUML変換ツールのプロトタイプ実装です。
日本語での業務フロー作成を簡単に行えるよう、アクター選択＋処理入力方式とパターン選択方式の2つのモードを提供します。

## 機能

### 1. アクター＋処理モード
- **Step 1**: ボタンクリックでアクターを選択
- **Step 2**: ドロップダウンとテキスト入力で処理を追加
- カスタムアクターの追加機能
- 未確定（？）と非同期（-->）のオプション
- **ドラッグ&ドロップ**: 処理フローの順序をマウスで簡単に変更
- **タッチ対応**: タブレットでも処理の順序変更が可能

### 2. パターン選択モード
- EC注文フロー
- 承認ワークフロー  
- 在庫管理フロー
- カスタムパターンの作成・保存

### 3. リアルタイムプレビュー
- Kroki APIを使用したSVGレンダリング
- ズーム機能（50%〜200%）
- ダウンロード機能

### 4. コードエディター
- **双方向編集対応**: PlantUMLコードを直接編集すると自動的にUIに反映
- **リアルタイム同期**: コード変更が即座にアクターと処理フローに同期
- **コードヒント**: Ctrl+Spaceで構文ヘルプを表示
- **Tabキー対応**: インデントの挿入
- コピー・整形・検証機能
- 🔄同期ボタンで手動同期も可能

### 5. draw.io連携機能 ✨NEW
- **draw.ioで開く**: 作成した図をワンクリックでdraw.ioで開いて編集
- **.drawioファイルダウンロード**: draw.io形式でローカル保存
- **編集可能なXML形式**: 図形として完全に編集可能な状態で出力
- **アクタータイプ自動判定**: 人物、システム、データベースを自動識別

## 使用方法

### ローカル環境での起動
1. フォルダ内のファイルを確認
```
PlantUML_Editor_Proto/
├── index.html
├── styles.css
├── app.js
├── drawio-converter.js
└── README.md
```

2. ブラウザで`index.html`を開く
   - ダブルクリックで開く
   - または右クリック → プログラムから開く → ブラウザを選択

### 基本的な使い方
1. **アクターを選択**: 左パネルでアクターボタンをクリック
2. **処理を入力**: 送信元・送信先を選択し、処理内容を入力
3. **順序を調整**: 処理フローをドラッグ&ドロップで並び替え
4. **プレビュー確認**: 右パネルで図を確認
5. **コード取得**: 中央パネルからコピー
6. **draw.ioエクスポート**: ヘッダーの「🔷 draw.io」ボタンで開く

### ドラッグ&ドロップの使い方
- **デスクトップ**: 処理項目の左側にある「☰」アイコンをドラッグ
- **タブレット**: 処理項目を長押ししてドラッグ
- **挿入位置**: 青いラインが表示される位置に挿入されます

### キーボードショートカット
| ショートカット | 機能 |
|--------------|------|
| `Ctrl+Z` | 最後の処理を削除 |
| `Ctrl+Shift+Z` | すべてクリア |
| `Ctrl+C` | コードをコピー |
| `Ctrl+D` | 最後の処理を複製 |
| `Ctrl+Space` | コードヒント表示（エディター内） |
| `F2` | コードを整形 |
| `F5` | プレビューを更新 |
| `Tab` | インデント挿入（エディター内） |
| `Enter` | 処理を追加（入力欄で） |

## 技術仕様

### 使用技術
- **フロントエンド**: Vanilla JavaScript (フレームワークなし)
- **スタイリング**: CSS3 (Grid, Flexbox)
- **レンダリング**: Kroki API (https://kroki.io)
- **圧縮**: Pako.js (CDN経由)

### ブラウザ要件
- Chrome 90+
- Edge 90+
- Firefox 88+
- Safari 14+

### API仕様
- **Kroki API**: PlantUML図のレンダリング
  - エンドポイント: `https://kroki.io/plantuml/svg/{encoded}`
  - エンコード: Deflate + Base64 (URL Safe)

## カスタマイズ

### アクターの追加
`app.js`の以下の部分を編集:
```javascript
// アクターボタンの定義
<button class="actor-btn" data-actor="新規アクター">
    <span class="actor-icon">🆕</span>
    <span>新規アクター</span>
</button>
```

### パターンの追加
`app.js`の`loadPatterns()`メソッドに新しいパターンを追加:
```javascript
{
    id: 'custom-pattern',
    name: 'カスタムパターン',
    category: 'custom',
    actors: ['アクター1', 'アクター2'],
    actions: [
        { from: 'アクター1', to: 'アクター2', text: '処理' }
    ]
}
```

## 重要な制限事項 ⚠️

### Kroki APIの並行処理構文の制限
Kroki APIは、PlantUML標準仕様の`par/and/end`構文をサポートしていません。代わりに`par/else/end`構文を使用する必要があります。

**PlantUML標準仕様（Krokiでは動作しない）:**
```plantuml
par
  A -> B: 処理1
and
  C -> D: 処理2
end
```

**Kroki API対応構文:**
```plantuml
par
  A -> B: 処理1
else
  C -> D: 処理2
end
```

この制限はKroki APIの実装によるものであり、PlantUML自体の仕様では`and`が正式な構文です。本アプリケーションでは、Kroki APIとの互換性を保つため、自動的に`else`を使用して並行処理を生成します。

## トラブルシューティング

### プレビューが表示されない
- インターネット接続を確認（Kroki APIへのアクセスが必要）
- ブラウザのコンソールでエラーを確認（F12キー）

### 文字化けする場合
- ファイルのエンコーディングがUTF-8であることを確認
- ブラウザの文字エンコーディング設定を確認

### レンダリングエラー
- PlantUML構文が正しいか確認（検証ボタンを使用）
- @startumlと@endumlが含まれているか確認
- 並行処理を使用する場合は`par/else/end`構文を使用（`par/and/end`は使用不可）

## 今後の拡張予定

### Phase 1（実装済み）
- ✅ 基本UI
- ✅ アクター選択機能
- ✅ 処理入力機能
- ✅ Kroki API統合
- ✅ プレビュー機能
- ✅ ドラッグ&ドロップによる順序変更
- ✅ draw.io XML出力機能

### Phase 2（計画中）
- [ ] 日本語テキスト入力モード
- [ ] より多くのパターンテンプレート
- [ ] LocalStorage永続化
- [ ] アクティビティ図・クラス図対応

### Phase 3（将来）
- [ ] AI支援（MCP Server統合）
- [ ] リアルタイムコラボレーション
- [ ] バージョン管理
- [ ] チーム共有機能

## ライセンス
このプロトタイプは開発用サンプルです。

## 作成者
PlantUML変換ツール開発チーム

---

*最終更新: 2025年8月12日*