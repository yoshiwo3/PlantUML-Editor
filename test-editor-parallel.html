<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>PlantUML Editor - 並行処理テスト（par/else/end）</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { display: flex; gap: 20px; }
        .panel { flex: 1; border: 1px solid #ddd; padding: 15px; }
        textarea { width: 100%; height: 300px; font-family: monospace; }
        button { padding: 10px 20px; margin: 10px 0; background: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background: #45a049; }
        #result { margin-top: 20px; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        #preview { max-width: 100%; }
    </style>
</head>
<body>
    <h1>PlantUML Editor - par/else/end構文テスト</h1>
    <p>Kroki API対応の並行処理構文（par/else/end）をテストします。</p>
    
    <div class="container">
        <div class="panel">
            <h2>PlantUMLコード</h2>
            <textarea id="code">@startuml
actor 顧客
participant システム
participant 在庫管理
participant 決済処理

顧客 -> システム : 注文送信

par
  システム -> 在庫管理 : 在庫確認
  在庫管理 --> システム : 在庫OK
else
  システム -> 決済処理 : 決済実行
  決済処理 --> システム : 決済完了
end

システム --> 顧客 : 注文完了通知
@enduml</textarea>
            <button onclick="renderDiagram()">レンダリング実行</button>
            <button onclick="testOriginalSyntax()">par/and/end構文テスト（エラー確認用）</button>
        </div>
        
        <div class="panel">
            <h2>プレビュー</h2>
            <div id="result"></div>
            <div id="preview"></div>
        </div>
    </div>

    <script>
        async function renderDiagram() {
            const code = document.getElementById('code').value;
            const resultDiv = document.getElementById('result');
            const previewDiv = document.getElementById('preview');
            
            resultDiv.innerHTML = 'レンダリング中...';
            previewDiv.innerHTML = '';
            
            try {
                // POSTメソッドでKroki APIに送信
                const response = await fetch('https://kroki.io/plantuml/svg', {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: code
                });
                
                if (response.ok) {
                    const svg = await response.text();
                    resultDiv.innerHTML = '<span class="success">✅ レンダリング成功！par/else/end構文が正常に動作しています。</span>';
                    previewDiv.innerHTML = svg;
                } else {
                    const error = await response.text();
                    resultDiv.innerHTML = `<span class="error">❌ エラー: ${response.status}</span>`;
                    previewDiv.innerHTML = `<pre>${error}</pre>`;
                }
            } catch (e) {
                resultDiv.innerHTML = `<span class="error">❌ ネットワークエラー: ${e.message}</span>`;
            }
        }
        
        function testOriginalSyntax() {
            // PlantUML標準のpar/and/end構文（Krokiでエラーになることを確認）
            document.getElementById('code').value = `@startuml
actor 顧客
participant システム
participant 在庫管理
participant 決済処理

顧客 -> システム : 注文送信

par
  システム -> 在庫管理 : 在庫確認
  在庫管理 --> システム : 在庫OK
and
  システム -> 決済処理 : 決済実行
  決済処理 --> システム : 決済完了
end

システム --> 顧客 : 注文完了通知
@enduml`;
            
            alert('PlantUML標準のpar/and/end構文に変更しました。\nKroki APIでは400エラーになることを確認してください。');
        }
        
        // ページロード時に自動レンダリング
        window.onload = () => {
            renderDiagram();
        };
    </script>
</body>
</html>