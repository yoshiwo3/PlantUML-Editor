# PlantUMLアプリ要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
日本語→PlantUML変換アプリ（SaaSサブスク業務特化版）

### 1.2 目的
SaaS販売ECサイトの複雑な業務フローを、図解作成経験のない素人でも簡単に、正確に図解できるツールを提供する。

### 1.3 背景
- **現状**: Excel/PowerPointで図を作成（3時間/回）
- **課題**: 複雑な業務フロー（見積→契約→請求）の図解が困難
- **特徴**: 運用が固まっていない段階での利用が多い
- **緊急性**: 会議30分前に急遽図を求められることが頻繁にある

### 1.4 ユーザーの本質的ニーズ
**「複雑なSaaSサブスク業務（見積→契約→請求）の詳細な条件分岐や部門間連携を、図解経験ゼロでも、日本語を書くだけで、仕様書品質の図として10分で作成でき、足りない情報は対話で補完してくれる、素人に優しいツール」**

## 2. ユーザー情報

### 2.1 対象ユーザー
- **業種**: SaaS販売のECサイト運営（物販なし）
- **主要ユーザー**: EC運用担当者、営業担当者
- **技術レベル**: 非エンジニア（図解作成経験なし、PlantUML記法の知識なし）
- **利用環境**: Windows、社内ネットワーク
- **現在の作業ツール**: Excel、PowerPoint

### 2.2 業務の特徴
- **販売形態**: サービス販売（サブスクリプション型）
- **課金モデル**: 月額/年額のサブスクリプション
- **関係部門**: 
  - EC基盤チーム（システム管理、ライセンス発行）
  - 経理部門（請求処理、返金処理）
  - 営業部門（営業担当者、営業管理者）
- **業務の複雑性**: 部門を跨ぐ複雑な条件分岐フローが日常的

### 2.3 利用シーン
1. **仕様書作成**: 基本設計書、詳細設計書への業務フロー図貼り付け
2. **会議資料作成**: 30分前に急遽依頼される図解作成
3. **運用設計**: 運用が固まっていない段階での複数案（A案/B案）検討
4. **システム設計**: ECカートシステムのER図作成（システム知識なしで）
5. **月次定例**: 見積→契約→請求フローの改善案提示

### 2.4 典型的な使用シナリオ
#### シナリオ1: 月曜朝の会議準備
```
8:30 上司「9:00の会議で先週の見積フローを図にして説明して」
8:35 アプリ起動
8:40 日本語で流れを入力
8:42 アプリが不足情報を質問
8:45 図が完成、PowerPointに貼り付け
8:50 準備完了（所要時間：20分 → 目標：10分以内）
```

## 3. 機能要件

### 3.1 入力機能

#### 3.1.1 テキスト入力
- **形式**: 日本語の散文または箇条書き
- **例**: 「顧客が見積依頼して、営業が確認して、承認されたら契約する」
- **要件**: PlantUML記法の知識不要

#### 3.1.2 画像入力
- **対応形式**: PNG、JPG、GIF、BMP
- **機能**: 
  - Excel画面キャプチャのOCR解析
  - 手書きメモの認識
  - ホワイトボード写真の解析
- **入力方法**: ドラッグ&ドロップ、ファイル選択、クリップボード貼り付け

#### 3.1.3 対話型入力補完
- **機能**: 不足情報をアプリが質問（ユーザーの要望：「足りない部分はAPPから質問してもらいたい」）
- **質問例**:
  - 「誰が承認しますか？」→ [上司][営業部][自動承認]
  - 「承認されなかった場合は？」→ [キャンセル][差し戻し][保留]
  - 「金額の条件を教えてください」→ 段階的な金額入力フォーム
- **特徴**: 
  - デフォルト値を提示、スキップ可能
  - 業界用語を理解（例：「日割り」「サブスク」「ライセンス」）
  - 最大3回の質問で完了（煩わしさを避ける）

### 3.2 変換処理

#### 3.2.1 業務フロー認識
- **対応する複雑な要素**:
  - 条件分岐（多段階承認、金額による分岐）
  - 並列処理（複数部門の同時処理）
  - ループ処理（修正依頼の繰り返し）
  - 部門横断フロー（EC基盤、経理、営業）

#### 3.2.2 SaaSサブスク特化機能（最重要）
- **見積業務**（ユーザー指摘：「見積業務が一番処理が複雑」）:
  - 新規顧客/既存顧客/更新時の3パターン自動判別
  - 多段階承認フロー:
    - 割引率20%未満 → 課長承認
    - 割引率50%未満 → 部長承認
    - 割引率50%以上 → 役員承認
    - 特別条件 → 個別承認ルート
  - 価格計算の複雑性:
    - 契約期間中の日割り計算
    - ボリュームディスカウント
    - オプション組み合わせ価格
    - 初期費用の有無
- **契約変更**（契約期間中の処理）:
  - 数量追加（ライセンス追加）と即時反映
  - 数量削減と次回更新時調整
  - オプション追加/削除
  - プラン変更（アップグレード/ダウングレード）
- **更新処理**:
  - 自動更新/手動更新の切り替え
  - 更新時の条件変更（数量増減、オプション変更）
  - 更新割引の適用
- **解約処理**:
  - 部分解約（特定ライセンス/オプションのみ）
  - 全体解約
  - 年額前払いの日割り返金計算
  - 解約後30日間のデータ保管

#### 3.2.3 未確定要素の表現
- **機能**:
  - 「？」付きで点線表示
  - A案/B案の並列表示
  - 「未定」「検討中」の明示

### 3.3 出力機能

#### 3.3.1 画像出力
- **形式**: PNG（高解像度）、SVG（ベクター）
- **特徴**: 背景透過オプション、PowerPoint最適化

#### 3.3.2 コード出力
- **PlantUMLコード**: メンテナンス・再編集用
- **メタ情報**: 生成日時、バージョン、作成者

#### 3.3.3 仕様書用出力
- **Word/Excel形式**:
  ```
  【図】注文処理フロー
  [PNG画像]
  
  【PlantUMLコード】
  ```plantuml
  @startuml
  ...
  @enduml
  ```
  
  【生成日時】2025/08/11
  【バージョン】v1.0
  ```

#### 3.3.4 draw.io連携
- **形式**: draw.io XML
- **特徴**: 後から細かい編集が可能

### 3.4 ER図作成支援

#### 3.4.1 ECカート専用ウィザード
- **背景**: ユーザー要望「ECカートシステムのER図も作りたいけど、システム知識がなくてどう作っていいかわからない」
- **質問形式**: 
  - 「何を販売？」→ SaaS・サービス（物販なし）
  - 「課金方式？」→ サブスクリプション（月額/年額）
  - 「必要な機能？」→ チェックボックス選択（見積、契約、請求など）

#### 3.4.2 自動生成
- **基本テーブル**: 顧客、契約、プラン、請求、注文、見積
- **関係性**: 自動設定（1対多、多対多）
- **説明**: 各テーブルの日本語説明付き（「このテーブルは〇〇を管理します」）
- **SaaS特化**: 契約期間、ライセンス数、オプション管理を標準搭載

## 4. 非機能要件

### 4.1 使いやすさ（ユーザー要望：「利用者は素人です。直感的に利用できるアプリがいい」）
- **操作**: 3ステップ以内で図が完成
- **言語**: 専門用語を使わない（例：「エクスポート」→「保存」）
- **エラー処理**: エラーを出さない（不完全でも何か生成）
- **ヘルプ**: 邪魔にならない（？マークで表示）
- **直感性**: 
  - ボタンは大きく、わかりやすいアイコン付き
  - 次に何をすればいいか常に明確
  - 迷ったらデフォルト値で進められる

### 4.2 性能
- **レスポンス**: 
  - 初回表示: 1.5秒以内
  - プレビュー更新: 0.3秒以内
  - 図種判定: 0.1秒以内
- **処理能力**: 
  - 大規模フロー（100要素以上）対応
  - 複雑な分岐（10階層以上）対応

### 4.3 セキュリティ
- **データ処理**:
  - ローカル処理優先（社内利用）
  - 外部API利用は選択式
  - 機密データの自動検出
- **アクセス制御**: 
  - MVPは個人利用
  - Phase 2でチーム機能追加

## 5. 技術仕様

### 5.1 アーキテクチャ
```
フロントエンド（SPA）
├── 入力レイヤー
│   ├── テキストエディタ
│   ├── 画像アップローダー
│   └── 対話型フォーム
├── 処理レイヤー
│   ├── 日本語解析エンジン
│   ├── OCR処理（Tesseract.js）
│   └── PlantUML生成器
└── 出力レイヤー
    ├── レンダリング
    ├── エクスポート
    └── draw.io変換

バックエンド（Node.js/Express）
├── /api/convert - 変換処理
├── /api/analyze-image - 画像解析
├── /api/render - レンダリング
└── /api/export - 各種出力
```

### 5.2 技術スタック
- **フロントエンド**: HTML5, CSS3, Vanilla JavaScript
- **バックエンド**: Node.js, Express
- **OCR**: Tesseract.js
- **レンダリング**: 
  - ローカル: plantuml.js
  - 外部: Kroki API（オプション）
- **コンテナ**: Docker

## 6. 実装フェーズ

### Phase 1: MVP（2週間）
**目標**: 基本的な変換機能の実現
- ✅ 日本語→PlantUML変換
- ✅ 対話型情報補完
- ✅ 基本5図種対応（シーケンス、アクティビティ、クラス、状態、ガント）
- ✅ 仕様書用出力
- ✅ SaaSサブスク業務テンプレート

### Phase 2: 機能拡張（3週間）
**目標**: 使いやすさの向上
- ⬜ 画像アップロード・OCR
- ⬜ draw.io XML出力
- ⬜ 複雑なフローの段階的作成
- ⬜ ER図作成ウィザード
- ⬜ 承認フロー詳細設定

### Phase 3: チーム対応（4週間）
**目標**: 組織利用への対応
- ⬜ 履歴管理
- ⬜ テンプレート共有
- ⬜ ユーザー管理
- ⬜ 共同編集機能

## 7. 成功指標（KPI）

### 7.1 品質指標
- **変換成功率**: 90%以上（初回で意図した図が生成される）
- **図種判定精度**: 80%以上（自動判定の正解率）
- **エラー回復率**: 70%以上（ヒントで自己解決）

### 7.2 効率指標
- **作成時間**: 10分以内（現状3時間→10分 = **18倍の効率化**）
- **修正回数**: 3回以内（初回生成後の修正）
- **学習期間**: 30分以内（使い方を理解）

### 7.3 利用指標
- **日次利用率**: 80%以上（導入後1ヶ月）
- **機能利用率**: 各機能50%以上
- **満足度**: 4.0以上/5.0

### 7.4 定性的指標
- **満足度**: 「もうPowerPointには戻れない」
- **推奨度**: 「同僚に勧めたい」
- **依存度**: 「このツールなしでは仕事にならない」

## 8. ユーザー特有の課題と対策

### 8.1 現在直面している問題
| 問題 | 現状 | 本アプリでの解決策 |
|------|------|------------------|
| 図作成に3時間かかる | PowerPointで手動作成 | 10分以内で自動生成 |
| 複雑な業務を表現できない | 条件分岐が多すぎて困難 | 対話型で段階的に詳細化 |
| 運用未確定での作業 | どう表現していいか不明 | 「？」やA/B案で表現可能 |
| 会議直前の急な依頼 | 対応できない | 3ステップで即座に生成 |
| システム知識不足 | ER図が作れない | 質問に答えるだけで完成 |

### 8.2 リスクと対策

#### 技術的リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| 日本語解析の精度不足 | 高 | 対話型補完で対応 |
| 複雑なフローの表現限界 | 高 | テンプレート不要の自由記述 |
| OCR認識精度 | 中 | 手動修正機能を提供 |

#### 業務リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| 既存ツールからの移行抵抗 | 高 | Excel/PPT連携強化 |
| 学習コスト | 中 | 素人向けの直感的UI |
| セキュリティ懸念 | 高 | ローカル処理を標準に |

## 9. 特記事項

### 9.1 重要な設計方針
1. **素人優先**: 「利用者は図解を作成したことがない素人」を前提
2. **対話型補完**: 「足りない部分はAPPから質問」を実現
3. **複雑な業務対応**: 「見積業務が一番処理が複雑」に対応
4. **仕様書品質**: 「コードと画像両方」を出力
5. **テンプレート不要**: 「よくあるパターンでは作れない」独自フローに対応

### 9.2 ユーザーの声（開発の指針）
- 「流れを日本語で書くのでそれを咀嚼してPUMLコードにできるといい」
- 「利用者は素人です。直感的に利用できるアプリがいい」
- 「作成したPlantUMLを仕様書に貼り付けたい。コードと画像両方」
- 「ECカートシステムのER図も作りたいけど、システム知識がなくてどう作っていいかわからない」
- 「作りたいのは複雑な業務のフローです」

### 9.3 将来の拡張性
- チーム展開（MVPは個人、将来はチーム利用）
- AI活用による自動最適化
- 他システムとのAPI連携
- モバイル対応

---

*作成日: 2025年8月11日*  
*バージョン: 2.0（ユーザー要望詳細をマージ）*  
*作成者: PlantUMLアプリ開発チーム*