<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>PlantUML 並行処理テスト（POSTメソッド）</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        textarea { width: 100%; height: 200px; font-family: monospace; }
        button { padding: 10px 20px; background: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #1976D2; }
        #result { margin-top: 20px; padding: 20px; background: #f5f5f5; min-height: 300px; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <div class="container">
        <h1>PlantUML 並行処理テスト（POSTメソッド）</h1>
        
        <div class="section">
            <h2>テストコード</h2>
            <textarea id="plantuml-code">@startuml
actor 顧客
participant システム
participant 在庫管理
participant 決済処理

顧客 -> システム : 注文送信

par
  システム -> 在庫管理 : 在庫確認
  在庫管理 --> システム : 在庫OK
and
  システム -> 決済処理 : 決済実行
  決済処理 --> システム : 決済完了
end

システム --> 顧客 : 注文完了通知
@enduml</textarea>
            <button onclick="testPOST()">POSTメソッドでテスト</button>
            <button onclick="testGET()">GETメソッドでテスト</button>
        </div>
        
        <div class="section">
            <h2>結果</h2>
            <div id="result"></div>
        </div>
    </div>

    <script>
        async function testPOST() {
            const code = document.getElementById('plantuml-code').value;
            const resultDiv = document.getElementById('result');
            
            resultDiv.innerHTML = '<p>POSTメソッドでテスト中...</p>';
            
            try {
                const response = await fetch('https://kroki.io/plantuml/svg', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: code
                });
                
                const responseText = await response.text();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <p class="success">✓ POSTメソッド成功！ステータス: ${response.status}</p>
                        <div>${responseText}</div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <p class="error">✗ POSTメソッド失敗。ステータス: ${response.status}</p>
                        <pre>${responseText}</pre>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <p class="error">✗ エラー: ${error.message}</p>
                `;
            }
        }
        
        async function testGET() {
            const code = document.getElementById('plantuml-code').value;
            const resultDiv = document.getElementById('result');
            
            resultDiv.innerHTML = '<p>GETメソッドでテスト中...</p>';
            
            try {
                // pako.jsとplantuml-encoderを動的にロード
                if (!window.pako) {
                    const script = document.createElement('script');
                    script.src = 'https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js';
                    document.head.appendChild(script);
                    await new Promise(resolve => script.onload = resolve);
                }
                
                if (!window.plantumlEncoder) {
                    const script = document.createElement('script');
                    script.src = 'https://cdn.jsdelivr.net/npm/plantuml-encoder@1.4.0/dist/plantuml-encoder.min.js';
                    document.head.appendChild(script);
                    await new Promise(resolve => script.onload = resolve);
                }
                
                const encoded = plantumlEncoder.encode(code);
                const url = `https://kroki.io/plantuml/svg/${encoded}`;
                
                const response = await fetch(url);
                const responseText = await response.text();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <p class="success">✓ GETメソッド成功！ステータス: ${response.status}</p>
                        <div>${responseText}</div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <p class="error">✗ GETメソッド失敗。ステータス: ${response.status}</p>
                        <pre>${responseText}</pre>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <p class="error">✗ エラー: ${error.message}</p>
                `;
            }
        }
    </script>
</body>
</html>